<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Título del Archivo 2 -->
    <title>Ferremax - Herramientas y Materiales</title>
    <!-- Scripts y Links del Archivo 2 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://checkout.wompi.co/widget.js"></script>

    <!-- Estilos CSS del Archivo 2 -->
    <style>
        :root {
            --color-primary: #2563eb; /* Azul del archivo 2 */
            --color-primary-hover: #1d4ed8;
            --color-secondary: #059669; /* Verde del archivo 2 */
            --color-secondary-hover: #047857;
            --color-accent: #f8fafc; /* Casi blanco del archivo 2 */
            --color-price: var(--color-secondary);
            --color-success-bg: #d1fae5;
            --color-success-text: #065f46;
            --color-success-border: #a7f3d0;
            --color-dark: #1e293b; /* Gris oscuro del archivo 2 */
            --color-light: #f1f5f9; /* Gris claro del archivo 2 */
        }

        body {
            font-family: 'Poppins', 'Inter', sans-serif; /* Fuentes del archivo 2 */
            color: #334155; /* Color de texto base del archivo 2 */
            line-height: 1.6;
            position: relative;
            min-height: 100vh;
            background-color: var(--color-accent);
        }

        /* Fondo degradado del archivo 2 */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e2e8f0 0%, #f1f5f9 100%);
            z-index: -1;
        }

        .gradient-bg {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
        }

        .card-img-container {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ffffff; /* Fondo blanco explícito */
            overflow: hidden;
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0; /* Borde del archivo 2 */
        }

        .card-img-top {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
            display: block;
            transition: transform 0.3s ease;
        }

        /* Estilo hover del archivo 2 */
        .product-card:hover .card-img-top {
            transform: scale(1.05);
        }

        .product-price {
            color: var(--color-price);
            font-weight: 600;
        }

        .message {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem; /* Tailwind default: 0.375rem, Archivo 2 usa 0.5rem */
            font-weight: 500;
            display: none;
            border: 1px solid transparent;
        }

        .message-error {
            background-color: #fee2e2;
            color: #b91c1c;
            border-color: #fecaca;
        }

        .message-success {
            background-color: var(--color-success-bg);
            color: var(--color-success-text);
            border-color: var(--color-success-border);
        }

        .clickable-product,
        .buy-button-grid,
        .category-card,
        .admin-action-button,
        .cta-button,
        .admin-nav-item,
        .cart-icon-container,
        .add-to-cart-button,
        .product-detail-link {
            cursor: pointer;
            transition: all 0.2s ease; /* Transición suave del archivo 2 */
        }

        .product-detail-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem; /* Espaciado del archivo 2 */
            padding: 2rem; /* Padding del archivo 2 */
            background-color: #ffffff;
            border-radius: 1rem; /* Bordes más redondeados del archivo 2 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); /* Sombra del archivo 2 */
            max-width: 64rem; /* Ancho máximo del archivo 2 */
            margin: auto;
        }

        @media (min-width: 768px) {
            .product-detail-container {
                flex-direction: row;
                align-items: flex-start;
                padding: 2.5rem; /* Padding mayor en desktop del archivo 2 */
            }
        }

        .product-detail-image-container {
            width: 100%;
            max-width: 400px; /* Ancho imagen detalle del archivo 2 */
            flex-shrink: 0;
            background-color: #ffffff;
            border-radius: 0.75rem; /* Redondeo imagen detalle del archivo 2 */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); /* Sombra suave imagen detalle */
        }

        .product-detail-image {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 0.5rem;
        }

        /* No había .product-detail-info en archivo 2, mantenemos la del 1 por si el JS la usa */
         .product-detail-info { flex-grow: 1; width: 100%; }

        #payment-button-container {
            margin-top: 1.5rem;
            min-height: 50px;
            position: relative;
        }

        #payment-result-message {
            margin-top: 0.5rem; /* Estilo original mantenido */
        }

        h1, h2, h3, h4 {
            color: var(--color-dark); /* Color títulos archivo 2 */
            font-weight: 700;
        }

        .promo-banner {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%); /* Degradado archivo 2 */
            color: #ffffff;
            padding: 2.5rem 1.5rem; /* Padding banner archivo 2 */
            border-radius: 1rem; /* Redondeo banner archivo 2 */
            text-align: center;
            margin-bottom: 3rem; /* Margen banner archivo 2 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); /* Sombra banner archivo 2 */
        }

        .promo-banner h3 {
            font-size: 1.75rem; /* Tamaño título banner archivo 2 */
            font-weight: 700;
            margin-bottom: 1rem; /* Margen título banner archivo 2 */
            color: #ffffff; /* Asegurar color blanco */
        }

        .promo-banner p {
            margin-bottom: 1.5rem; /* Margen texto banner archivo 2 */
            font-size: 1.1rem; /* Tamaño texto banner archivo 2 */
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
             color: #ffffff; /* Asegurar color blanco */
        }

        .promo-banner .cta-button {
            background-color: #ffffff; /* Botón blanco en banner archivo 2 */
            color: var(--color-primary); /* Texto color primario en botón banner archivo 2 */
            padding: 0.75rem 2rem; /* Padding botón banner archivo 2 */
            border-radius: 0.5rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease; /* Transición botón banner archivo 2 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .promo-banner .cta-button:hover {
            background-color: #f8fafc; /* Hover botón banner archivo 2 */
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .carousel-container {
            max-width: 900px; /* Ancho carrusel archivo 2 */
            margin: 3rem auto; /* Margen carrusel archivo 2 */
            position: relative;
            overflow: hidden;
            border-radius: 1rem; /* Redondeo carrusel archivo 2 */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* Sombra carrusel archivo 2 */
            background-color: #ffffff;
        }

        .carousel-slides {
            display: flex;
            transition: transform 0.5s ease-in-out;
            background-color: #ffffff; /* Fondo slides archivo 2 */
        }

        .carousel-slide {
            min-width: 100%;
            box-sizing: border-box;
            text-align: center;
            padding: 2rem; /* Padding slide archivo 2 */
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px; /* Alto slide archivo 2 */
        }

        .carousel-slide.active {
            display: flex;
        }

        .carousel-slide img {
            max-height: 85%; /* Altura imagen carrusel archivo 2 */
            max-width: 90%; /* Ancho imagen carrusel archivo 2 */
            object-fit: contain;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); /* Sombra imagen carrusel */
        }

        .carousel-slide p {
            font-weight: 600; /* Peso texto carrusel archivo 2 */
            color: var(--color-dark); /* Color texto carrusel archivo 2 */
            font-size: 1.1rem; /* Tamaño texto carrusel archivo 2 */
            margin-top: auto;
        }

        .carousel-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.8); /* Fondo botón carrusel archivo 2 */
            color: var(--color-dark); /* Color icono botón carrusel archivo 2 */
            border: none;
            padding: 0.75rem; /* Padding botón carrusel archivo 2 */
            cursor: pointer;
            border-radius: 50%;
            z-index: 10;
            font-size: 1rem;
            width: 44px; /* Tamaño botón carrusel archivo 2 */
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); /* Sombra botón carrusel */
        }

        .carousel-button:hover {
            background-color: #ffffff; /* Hover botón carrusel archivo 2 */
            transform: translateY(-50%) scale(1.1); /* Efecto hover botón carrusel */
        }

        .carousel-button.prev {
            left: 20px; /* Posición botón prev archivo 2 */
        }

        .carousel-button.next {
            right: 20px; /* Posición botón next archivo 2 */
        }

        #categories-section {
            margin-top: 4rem; /* Margen categorías archivo 2 */
            margin-bottom: 4rem;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.25rem; /* Gap categorías archivo 2 */
        }

        @media (min-width: 640px) {
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .category-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        .category-card {
            background-color: white;
            border-radius: 0.75rem; /* Redondeo card categoría archivo 2 */
            padding: 1.75rem 1rem; /* Padding card categoría archivo 2 */
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease; /* Transición card categoría archivo 2 */
            border: 1px solid #e2e8f0; /* Borde card categoría archivo 2 */
        }

        .category-card:hover {
            transform: translateY(-5px); /* Efecto hover card categoría archivo 2 */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* Sombra hover card categoría archivo 2 */
            border-color: var(--color-primary); /* Borde hover card categoría archivo 2 */
        }

        .category-card i {
            font-size: 2.5rem; /* Tamaño icono categoría archivo 2 */
            color: var(--color-primary);
            margin-bottom: 1rem;
            display: block;
            transition: all 0.3s ease;
        }

        .category-card:hover i {
            transform: scale(1.1); /* Efecto hover icono categoría archivo 2 */
        }

        .category-card span {
            font-weight: 600;
            color: var(--color-dark); /* Color texto categoría archivo 2 */
            font-size: 0.95rem; /* Tamaño texto categoría archivo 2 */
        }

        #policies-section .policy-item {
            background-color: white;
            padding: 2rem; /* Padding políticas archivo 2 */
            border-radius: 0.75rem; /* Redondeo políticas archivo 2 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem; /* Margen políticas archivo 2 */
            border: 1px solid #e2e8f0; /* Borde políticas archivo 2 */
        }

        #policies-section .policy-item h3 {
            margin-bottom: 1rem; /* Margen título política archivo 2 */
            font-size: 1.5rem; /* Tamaño título política archivo 2 */
            font-weight: 700;
            color: var(--color-dark);
        }

        #policies-section .policy-item p {
            color: #475569; /* Color texto política archivo 2 */
            line-height: 1.7;
        }

        #admin-section-container {
            background-color: white;
            padding: 2rem; /* Padding admin archivo 2 */
            border-radius: 1rem; /* Redondeo admin archivo 2 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); /* Sombra admin archivo 2 */
            border: 1px solid #e2e8f0; /* Borde admin archivo 2 */
        }

        #admin-products-section .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }

        #admin-products-section .admin-table th,
        #admin-products-section .admin-table td {
            border: 1px solid #e2e8f0; /* Borde tabla admin archivo 2 */
            padding: 1rem; /* Padding tabla admin archivo 2 */
            text-align: left;
            vertical-align: middle;
            font-size: 0.9rem; /* Tamaño texto tabla admin archivo 2 */
        }

        #admin-products-section .admin-table th {
            background-color: #f8fafc; /* Fondo header tabla admin archivo 2 */
            font-weight: 600;
            color: #334155; /* Color header tabla admin archivo 2 */
        }

        #admin-products-section .admin-table td {
            color: #475569; /* Color celdas tabla admin archivo 2 */
        }

        #admin-products-section .admin-table img.product-thumbnail {
            max-height: 50px;
            width: auto;
            display: block;
            margin: auto;
            background-color: #f8fafc; /* Fondo thumb admin archivo 2 */
            border-radius: 0.25rem;
        }

        #admin-products-section .admin-action-button {
            padding: 0.5rem 0.8rem;
            border-radius: 0.375rem;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            border: none;
            color: white;
            transition: all 0.2s ease;
        }

        #admin-products-section .edit-button {
            background-color: var(--color-primary);
        }

        #admin-products-section .edit-button:hover {
            background-color: var(--color-primary-hover);
            transform: translateY(-1px);
        }

        #admin-products-section .delete-button {
            background-color: #dc2626; /* Rojo para borrar */
        }

        #admin-products-section .delete-button:hover {
            background-color: #b91c1c; /* Rojo oscuro hover */
            transform: translateY(-1px);
        }

        #admin-add-edit-product-form-container {
            background-color: #f8fafc; /* Fondo form admin archivo 2 */
            padding: 2rem;
            border-radius: 0.75rem;
            margin-top: 2rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        #admin-product-form label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #334155; /* Color label form admin archivo 2 */
            font-size: 0.9rem;
        }

        #admin-product-form input[type="text"],
        #admin-product-form input[type="number"],
        #admin-product-form textarea,
        #admin-product-form select {
            width: 100%;
            padding: 0.6rem 0.9rem; /* Padding inputs admin archivo 2 */
            border: 1px solid #cbd5e1; /* Borde inputs admin archivo 2 */
            border-radius: 0.5rem; /* Redondeo inputs admin archivo 2 */
            margin-bottom: 1rem;
            box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            background-color: #ffffff;
            color: #334155;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        #admin-product-form textarea {
            min-height: 100px; /* Altura textarea admin archivo 2 */
        }

        #admin-product-form .form-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem; /* Gap botones form admin archivo 2 */
            margin-top: 1.5rem;
        }

        #admin-product-form input:focus,
        #admin-product-form textarea:focus,
        #admin-product-form select:focus {
            outline: none;
            border-color: var(--color-secondary); /* Color borde focus archivo 2 */
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1); /* Sombra focus archivo 2 (usando secundario) */
        }

         /* Estilos personalización */
        #personalize-section label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #334155;
            font-size: 0.9rem;
        }
         #personalize-section input[type="color"] {
             width: 100px; /* Ancho color picker archivo 2 */
             height: 40px;
             border: 1px solid #cbd5e1;
             border-radius: 0.5rem;
             padding: 0.25rem;
             cursor: pointer;
             vertical-align: middle;
             box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
         }
         #personalize-section input[type="text"],
         #personalize-section textarea {
            width: 100%;
            padding: 0.6rem 0.9rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            font-size: 0.9rem;
         }
          #personalize-section textarea {
             min-height: 100px;
          }
         #personalize-section input[type="text"]:focus,
         #personalize-section textarea:focus {
            outline: none;
            border-color: var(--color-primary); /* Color borde focus personalización archivo 2 */
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); /* Sombra focus personalización archivo 2 (usando primario) */
         }
        #personalize-section .color-input-group {
            display: flex;
            align-items: center;
            gap: 0.75rem; /* Gap color inputs archivo 2 */
        }


        /* Estilos Botones Generales (.btn) del archivo 2 */
        .btn {
            font-weight: 600; /* Peso botones archivo 2 */
            padding: 0.6rem 1.25rem; /* Padding botones archivo 2 */
            border-radius: 0.5rem; /* Redondeo botones archivo 2 */
            transition: all 0.3s ease; /* Transición botones archivo 2 */
            text-align: center;
            border: 1px solid transparent;
            cursor: pointer;
             font-size: 0.9rem; /* Tamaño fuente botones archivo 2 */
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); /* Sombra botón primario archivo 2 */
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
            transform: translateY(-1px); /* Efecto hover botón primario archivo 2 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); /* Sombra hover botón primario archivo 2 */
        }

        .btn-secondary {
            background-color: var(--color-secondary);
            color: white;
            border-color: var(--color-secondary);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: var(--color-secondary-hover);
            border-color: var(--color-secondary-hover);
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .btn-accent {
             background-color: var(--color-accent);
             color: #334155; /* Color texto botón accent archivo 2 */
             border: 1px solid #cbd5e1; /* Borde botón accent archivo 2 */
             box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* Sombra botón accent archivo 2 */
        }

        .btn-accent:hover:not(:disabled) {
             background-color: #e2e8f0; /* Hover botón accent archivo 2 */
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background-color: #dc2626;
            color: white;
            border-color: #dc2626;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn-danger:hover:not(:disabled) {
            background-color: #b91c1c;
            border-color: #b91c1c;
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .btn-gray {
             background-color: #64748b; /* Gris botón gray archivo 2 */
             color: white;
             border-color: #64748b;
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn-gray:hover:not(:disabled) {
             background-color: #475569; /* Hover botón gray archivo 2 */
             border-color: #475569;
             transform: translateY(-1px);
             box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }


        .btn-full {
            width: 100%;
        }

        a.link-primary {
            color: var(--color-primary); /* Color link primario archivo 2 */
            font-weight: 600; /* Peso link primario archivo 2 */
            text-decoration: none;
            transition: all 0.2s ease;
        }

        a.link-primary:hover {
            color: var(--color-primary-hover); /* Hover link primario archivo 2 */
            text-decoration: underline;
        }

        /* Focus global para inputs específicos (login, registro, contacto) */
        #login-section input:focus,
        #register-section input:focus,
        #contact-section input:focus,
        #contact-section textarea:focus {
            outline: none;
            border-color: var(--color-primary) !important; /* Borde focus archivo 2 */
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1) !important; /* Sombra focus archivo 2 */
        }

        /* Carrito */
        .cart-icon-container {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white; /* Color icono carrito header */
             transition: all 0.2s ease; /* Transición icono carrito */
        }
         .cart-icon-container:hover {
             transform: scale(1.1); /* Hover icono carrito */
         }

        .cart-icon-container i {
            font-size: 1.3rem; /* Tamaño icono carrito archivo 2 */
        }

        .cart-item-count {
            position: absolute;
            top: -8px; /* Posición contador carrito archivo 2 */
            right: -12px; /* Posición contador carrito archivo 2 */
            background-color: var(--color-secondary); /* Fondo contador carrito archivo 2 */
            color: white;
            border-radius: 50%;
            padding: 0.2em 0.5em; /* Padding contador carrito archivo 2 */
            font-size: 0.7rem; /* Tamaño contador carrito archivo 2 */
            font-weight: bold;
            line-height: 1;
            min-width: 18px; /* Ancho mínimo contador carrito archivo 2 */
            text-align: center;
            border: 2px solid white; /* Borde contador carrito archivo 2 */
        }

        .cart-item img {
            width: 70px; /* Ancho imagen item carrito archivo 2 */
            height: 70px; /* Alto imagen item carrito archivo 2 */
            object-fit: contain;
            margin-right: 1.5rem;
            background-color: #f8fafc; /* Fondo imagen item carrito archivo 2 */
            border: 1px solid #e2e8f0; /* Borde imagen item carrito archivo 2 */
            border-radius: 0.5rem;
             padding: 0.5rem; /* Padding imagen item carrito archivo 2 */
        }

        .cart-item input[type="number"] {
            width: 70px; /* Ancho input cantidad carrito archivo 2 */
            text-align: center;
            padding: 0.4rem 0.6rem; /* Padding input cantidad carrito archivo 2 */
            border: 1px solid #cbd5e1; /* Borde input cantidad carrito archivo 2 */
            border-radius: 0.5rem;
            appearance: none;
            -moz-appearance: textfield;
            box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        /* Ocultar flechas input number */
        .cart-item input[type=number]::-webkit-inner-spin-button,
        .cart-item input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .remove-item-btn {
            color: #dc2626; /* Color botón eliminar archivo 2 */
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem; /* Tamaño botón eliminar archivo 2 */
            padding: 0.4rem 0.6rem; /* Padding botón eliminar archivo 2 */
            line-height: 1;
            transition: all 0.2s ease;
        }

        .remove-item-btn:hover {
            color: #b91c1c; /* Hover botón eliminar archivo 2 */
            transform: scale(1.1); /* Efecto hover botón eliminar archivo 2 */
        }

        /* Feedback botón añadir carrito */
        .btn.add-to-cart-button.added-feedback {
            background-color: var(--color-secondary) !important;
            border-color: var(--color-secondary) !important;
             /* Podrías añadir una transición o animación aquí si quieres */
        }

        /* --- Animaciones y Efectos Adicionales del Archivo 2 --- */

        /* Animación FadeIn */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Efecto hover para cards de productos */
        .product-card { /* Asegúrate que tus cards tengan esta clase */
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden; /* Necesario para el ::before */
        }
        .product-card::before { /* Overlay gradiente sutil en hover */
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%); /* Usa colores primario/secundario */
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0; /* Detrás del contenido */
        }
        .product-card:hover::before {
            opacity: 1;
        }
         /* Asegurar que el contenido esté sobre el overlay */
        .product-card > div { /* Asumiendo que el contenido está en divs directos */
            position: relative;
            z-index: 1;
        }


        /* Mejoras en el header */
        .main-header {
            /* background-color: var(--color-dark); Ya aplicado con Tailwind bg-gray-900 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease; /* Transición para scroll */
        }
        .main-header.scrolled { /* Clase a añadir con JS al hacer scroll */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); /* Sombra más pronunciada */
            /* Podrías cambiar el background aquí si quisieras */
        }

        /* Mejoras en los formularios de autenticación/contacto */
        .auth-form, .contact-form { /* Clases para los contenedores de forms */
             box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); /* Sombra más profunda */
             border: 1px solid #e2e8f0; /* Borde sutil */
        }

        /* Mejoras en el footer */
        .main-footer {
            /* background-color: var(--color-dark); Ya aplicado con Tailwind bg-gray-900 */
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1); /* Sombra superior */
        }

        /* Efecto hover para botones de navegación */
        .nav-link { /* Clase para los enlaces <a> del nav principal */
             position: relative;
             /* padding-bottom: 4px; Ajusta si es necesario */
        }
        .nav-link::after { /* Subrayado animado */
             content: '';
             position: absolute;
             bottom: 0; /* Ajusta si cambiaste el padding */
             left: 0;
             width: 0;
             height: 2px;
             background-color: white; /* O color primario si el fondo no es oscuro */
             transition: width 0.3s ease;
        }
        .nav-link:hover::after {
             width: 100%;
        }

        /* Mejoras en el carrito (resumen) */
        .cart-summary { /* Clase para el div de resumen del carrito */
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        /* Efecto de carga simple */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3); /* Spinner claro */
            border-radius: 50%;
            border-top-color: white; /* Color principal del spinner */
            animation: spin 1s ease-in-out infinite;
        }
         /* Para spinners en fondos claros */
         .loading-spinner-dark {
             border: 3px solid rgba(0, 0, 0, 0.1);
             border-top-color: var(--color-primary); /* O color oscuro deseado */
             animation: spin 1s ease-in-out infinite;
         }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

    </style>
</head>

<!-- Body y Estructura HTML del Archivo 2 -->
<body class="flex flex-col min-h-screen">

    <div class="flex-grow">

        <!-- Sección de Login -->
        <section id="login-section" class="container mx-auto mt-12 p-8 max-w-md bg-white rounded-xl shadow-lg auth-form">
            <div class="text-center mb-8">
                <img src="https://placehold.co/100x100/2563eb/ffffff?text=F" alt="Ferremax Logo" class="mx-auto h-16 w-16 rounded-full mb-4">
                <h2 class="text-3xl font-bold text-gray-800">Iniciar Sesión</h2>
                <p class="text-gray-600 mt-2">Accede a tu cuenta para continuar</p>
            </div>

            <div id="login-message" class="message"></div>

            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="login-email" class="block text-gray-700 text-sm font-semibold mb-2">Correo Electrónico</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-envelope text-gray-400"></i>
                        </div>
                        <input type="email" id="login-email" class="pl-10 w-full py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="tu@email.com" required>
                    </div>
                </div>

                <div>
                    <label for="login-password" class="block text-gray-700 text-sm font-semibold mb-2">Contraseña</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-lock text-gray-400"></i>
                        </div>
                        <input type="password" id="login-password" class="pl-10 w-full py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="********" required>
                    </div>
                </div>

                <div class="flex items-center justify-between">
                     <div class="flex items-center">
                         <!-- Funcionalidad 'Recordarme' podría necesitar JS adicional si se quiere implementar -->
                        <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                        <label for="remember-me" class="ml-2 block text-sm text-gray-700">Recordarme</label>
                    </div>
                    <div class="text-sm">
                        <a href="#" class="font-medium text-blue-600 hover:text-blue-500">¿Olvidaste tu contraseña?</a>
                    </div>
                </div>

                <div>
                     <!-- Botón usa clases .btn .btn-primary del CSS -->
                    <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out btn btn-primary">
                        Iniciar Sesión
                    </button>
                </div>
            </form>

            <div class="mt-6">
                <div class="relative">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">¿No tienes cuenta?</span>
                    </div>
                </div>

                <div class="mt-6">
                    <!-- Botón usa clases .btn .btn-accent del CSS -->
                    <button id="show-register" class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-lg shadow-sm text-sm font-semibold text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out btn btn-accent">
                        Regístrate
                    </button>
                </div>
            </div>
        </section>

        <!-- Sección de Registro -->
        <section id="register-section" class="container mx-auto mt-12 p-8 max-w-md bg-white rounded-xl shadow-lg auth-form" style="display: none;">
             <div class="text-center mb-8">
                <img src="https://placehold.co/100x100/2563eb/ffffff?text=F" alt="Ferremax Logo" class="mx-auto h-16 w-16 rounded-full mb-4">
                <h2 class="text-3xl font-bold text-gray-800">Crear Cuenta</h2>
                <p class="text-gray-600 mt-2">Regístrate para comenzar</p>
            </div>

            <div id="register-message" class="message"></div>

            <form id="registerForm" class="space-y-6">
                 <div>
                    <label for="register-username" class="block text-gray-700 text-sm font-semibold mb-2">Nombre de Usuario</label>
                    <div class="relative">
                         <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                           <i class="fas fa-user text-gray-400"></i>
                        </div>
                        <input type="text" id="register-username" class="pl-10 w-full py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Tu Usuario" required>
                    </div>
                </div>

                <div>
                    <label for="register-email" class="block text-gray-700 text-sm font-semibold mb-2">Correo Electrónico</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                           <i class="fas fa-envelope text-gray-400"></i>
                        </div>
                        <input type="email" id="register-email" class="pl-10 w-full py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="tu@email.com" required>
                    </div>
                </div>

                <div>
                    <label for="register-password" class="block text-gray-700 text-sm font-semibold mb-2">Contraseña</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                           <i class="fas fa-lock text-gray-400"></i>
                        </div>
                        <input type="password" id="register-password" class="pl-10 w-full py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Mín 6 caracteres" required minlength="6">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">La contraseña debe tener al menos 6 caracteres.</p>
                </div>

                <div class="flex items-center">
                    <input id="terms" name="terms" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" required>
                    <label for="terms" class="ml-2 block text-sm text-gray-700">
                        Acepto los <a href="#" class="text-blue-600 hover:text-blue-500">Términos y Condiciones</a>
                    </label>
                </div>

                <div>
                    <!-- Botón usa clases .btn .btn-secondary (o .btn-primary si prefieres) -->
                    <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-semibold text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out btn btn-secondary">
                        Registrarse
                    </button>
                </div>
            </form>

             <div class="mt-6 text-center text-sm">
                <p class="text-gray-600">¿Ya tienes cuenta?
                    <button id="show-login" class="font-medium text-blue-600 hover:text-blue-500">Inicia sesión</button>
                </p>
            </div>
        </section>

        <!-- Contenido Principal (después de login) -->
        <section id="main-content" style="display: none;">
            <!-- Header del Archivo 2 -->
            <header class="main-header bg-gray-900 text-white shadow-lg sticky top-0 z-50 transition-all duration-300">
                 <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-20"> <!-- Header más alto -->
                        <div class="flex items-center">
                             <img src="https://placehold.co/40x40/2563eb/ffffff?text=F" alt="Logo Ferremax" class="h-10 w-10 rounded-full mr-3"> <!-- Logo en header -->
                            <h1 class="text-2xl sm:text-3xl font-bold">Ferremax</h1>
                        </div>

                        <nav class="hidden sm:flex sm:items-center sm:space-x-6"> <!-- Espaciado nav archivo 2 -->
                             <!-- Enlaces usan clase .nav-link para efecto hover CSS -->
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-800 admin-nav-item" data-section="home">Inicio</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-800 admin-nav-item" data-section="products">Productos</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-800 admin-nav-item cart-icon-container relative" data-section="cart" title="Ver Carrito">
                                <i class="fas fa-shopping-cart text-xl"></i> <!-- Icono más grande -->
                                <span id="cart-item-count-desktop" class="cart-item-count" style="display: none;">0</span>
                            </a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-800 admin-nav-item" data-section="contact">Contacto</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-800 admin-nav-item" data-section="policies">Políticas</a>

                             <!-- Menú Admin Desktop (igual al archivo 1, pero estilizado con .btn) -->
                             <div id="admin-menu-desktop-container" class="relative" style="display: none;">
                                <button id="admin-menu-desktop-button" class="btn btn-primary px-4 py-2 text-sm font-medium flex items-center">
                                    Administración <i class="fas fa-caret-down ml-2"></i>
                                </button>
                                <div id="admin-menu-desktop-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 border border-gray-200"> <!-- Dropdown con borde -->
                                    <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 admin-nav-item" data-section="admin-products">
                                        <i class="fas fa-boxes w-4 mr-2"></i> Productos <!-- Iconos en dropdown -->
                                    </a>
                                    <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 admin-nav-item" data-section="admin-personalize">
                                        <i class="fas fa-paint-brush w-4 mr-2"></i> Personalizar
                                    </a>
                                </div>
                            </div>

                            <!-- Botón Logout (igual al archivo 1, pero estilizado con .btn) -->
                            <button id="logoutButton" class="btn btn-danger py-2 px-4 text-sm ml-2 flex items-center">
                                <i class="fas fa-sign-out-alt mr-2"></i> Salir
                            </button>
                        </nav>

                        <!-- Botones Menú Móvil y Carrito (iguales al archivo 1) -->
                        <div class="sm:hidden flex items-center">
                            <a href="#" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white admin-nav-item cart-icon-container relative mr-3" data-section="cart" title="Ver Carrito">
                                <i class="fas fa-shopping-cart text-xl"></i>
                                <span id="cart-item-count-mobile-icon" class="cart-item-count" style="display: none;">0</span>
                            </a>
                            <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-controls="mobile-menu" aria-expanded="false">
                                <span class="sr-only">Abrir menú</span>
                                <!-- Icono Hamburguesa -->
                                <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                                </svg>
                                <!-- Icono X -->
                                <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                 <!-- Menú móvil (igual al archivo 1, pero con iconos y estilo base) -->
                <div class="sm:hidden hidden bg-gray-800" id="mobile-menu">
                    <div class="px-2 pt-2 pb-3 space-y-1">
                        <a href="#" class="flex items-center px-3 py-2 rounded-md text-base font-medium hover:bg-gray-700 admin-nav-item" data-section="home">
                            <i class="fas fa-home w-5 mr-2"></i> Inicio
                        </a>
                        <a href="#" class="flex items-center px-3 py-2 rounded-md text-base font-medium hover:bg-gray-700 admin-nav-item" data-section="products">
                            <i class="fas fa-tools w-5 mr-2"></i> Productos
                        </a>
                        <a href="#" class="flex items-center px-3 py-2 rounded-md text-base font-medium hover:bg-gray-700 admin-nav-item" data-section="cart">
                            <i class="fas fa-shopping-cart w-5 mr-2"></i> Carrito
                            <span id="cart-item-count-mobile-menu" class="cart-item-count inline-block ml-2 align-middle" style="display: none;">0</span>
                        </a>
                        <a href="#" class="flex items-center px-3 py-2 rounded-md text-base font-medium hover:bg-gray-700 admin-nav-item" data-section="contact">
                             <i class="fas fa-envelope w-5 mr-2"></i> Contacto
                        </a>
                        <a href="#" class="flex items-center px-3 py-2 rounded-md text-base font-medium hover:bg-gray-700 admin-nav-item" data-section="policies">
                             <i class="fas fa-file-alt w-5 mr-2"></i> Políticas
                        </a>

                        <div id="admin-menu-mobile-container" class="pt-2 border-t border-gray-700 mt-2" style="display: none;">
                            <span class="block px-3 pt-2 pb-1 text-xs font-semibold text-gray-400 uppercase">Administración</span>
                            <a href="#" class="flex items-center px-3 py-2 rounded-md text-base font-medium hover:bg-gray-700 admin-nav-item" data-section="admin-products">
                                <i class="fas fa-boxes w-5 mr-2"></i> Productos
                            </a>
                            <a href="#" class="flex items-center px-3 py-2 rounded-md text-base font-medium hover:bg-gray-700 admin-nav-item" data-section="admin-personalize">
                                <i class="fas fa-paint-brush w-5 mr-2"></i> Personalizar
                            </a>
                        </div>

                         <!-- Botón Logout móvil (igual al archivo 1, pero estilizado) -->
                         <button id="logoutButtonMobile" class="w-full text-left flex items-center px-3 py-2 rounded-md text-base font-medium btn btn-danger mt-3">
                           <i class="fas fa-sign-out-alt mr-2"></i> Cerrar Sesión
                        </button>
                    </div>
                </div>
            </header>

            <!-- Contenido de la página (estructura igual al archivo 1, pero usa estilos archivo 2) -->
            <main class="container mx-auto mt-8 mb-12 px-4 sm:px-6" id="page-content">

                <!-- Sección de Inicio -->
                <div id="home-section" style="display: none;">
                    <div class="text-center mb-12 fade-in"> <!-- Animación fade-in -->
                        <h2 id="main-welcome-title" class="text-4xl font-bold text-gray-800 mb-4">Bienvenido a Ferremax</h2>
                        <p class="text-xl text-gray-600 max-w-3xl mx-auto">Tu ferretería de confianza con los mejores productos y precios</p>
                    </div>

                    <div class="promo-banner fade-in" style="animation-delay: 0.2s;"> <!-- Animación fade-in con delay -->
                        <h3 id="main-promo-title">¡Ofertas Especiales de Temporada!</h3>
                        <p id="main-promo-text">Descubre increíbles descuentos en herramientas profesionales y materiales de construcción. Aprovecha estas ofertas por tiempo limitado.</p>
                        <button class="cta-button admin-nav-item" data-section="products">
                            <i class="fas fa-arrow-right mr-2"></i> Ver Ofertas
                        </button>
                    </div>

                     <div class="max-w-4xl mx-auto text-center mb-16 fade-in" style="animation-delay: 0.4s;">
                        <p class="text-gray-600 text-lg">Desde 1999, Ferretería Ferremax ha sido un pilar en la industria de la construcción. Fundada por la familia Rodríguez, nuestra empresa ha crecido de una pequeña tienda local a un referente en calidad y servicio en la región. Nuestro compromiso es ofrecer productos de alta calidad y un servicio excepcional.</p>
                    </div>

                    <!-- Carrusel (igual al archivo 1, pero usa estilos archivo 2) -->
                    <div class="carousel-container fade-in" style="animation-delay: 0.6s;">
                        <div class="carousel-slides"></div>
                        <button class="carousel-button prev"><i class="fas fa-chevron-left"></i></button>
                        <button class="carousel-button next"><i class="fas fa-chevron-right"></i></button>
                    </div>

                    <!-- Categorías (igual al archivo 1, pero usa estilos archivo 2) -->
                    <section id="categories-section" class="mt-16 fade-in" style="animation-delay: 0.8s;">
                        <h3 class="text-3xl font-bold text-gray-800 mb-10 text-center">Explora por Categoría</h3>
                        <div id="category-grid-container" class="category-grid"></div>
                    </section>

                    <!-- Productos Destacados (igual al archivo 1, pero usa estilos archivo 2) -->
                     <div class="mt-20 fade-in" style="animation-delay: 1s;">
                        <h3 class="text-3xl font-bold text-gray-800 mb-10 text-center">Productos Destacados</h3>
                         <!-- Contenedor usa clases product-card para hover -->
                        <div id="featured-products-container" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
                    </div>
                </div>

                <!-- Sección de Productos -->
                 <div id="products-section" style="display: none;">
                     <div class="flex flex-col md:flex-row justify-between items-center mb-10">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4 md:mb-0">Nuestros Productos</h2>
                         <!-- Input de búsqueda (necesitaría JS adicional para funcionar) -->
                        <div class="relative w-full md:w-64">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                               <i class="fas fa-search text-gray-400"></i>
                            </div>
                            <input type="text" placeholder="Buscar productos..." class="pl-10 w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <!-- Contenedor usa clases product-card para hover -->
                    <div id="products-display-area">
                        <p class="col-span-full text-center text-gray-500 p-4">Cargando productos...</p>
                    </div>
                </div>


                <!-- Sección de Carrito -->
                 <div id="cart-section" style="display: none;">
                    <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Tu Carrito de Compras</h2>
                    <div class="max-w-5xl mx-auto">
                        <div id="cart-message" class="message mb-6"></div>
                        <div id="cart-items-container" class="bg-white p-6 rounded-xl shadow-md md:mb-8"> <!-- Estilo carrito archivo 2 -->
                            <p class="text-center text-gray-500 py-6">Tu carrito está vacío.</p>
                        </div>
                         <!-- Resumen Carrito usa clase .cart-summary -->
                        <div id="cart-summary-and-checkout" class="cart-summary p-6 rounded-xl shadow-md" style="display: none;">
                             <h3 class="text-xl font-semibold text-gray-800 mb-6 text-center border-b pb-4">Resumen del Pedido</h3>
                             <div class="space-y-4 mb-6">
                                <div class="flex justify-between">
                                    <span class="text-gray-700">Subtotal:</span>
                                    <span id="cart-subtotal" class="font-bold">$0.00</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">Envío:</span>
                                    <span class="font-bold">Gratis</span> <!-- O calcular dinámicamente -->
                                </div>
                                <div class="flex justify-between border-t pt-4">
                                    <span class="text-xl text-gray-800 font-semibold">Total:</span>
                                    <span id="cart-total" class="text-2xl font-bold text-blue-600">$0.00</span> <!-- Total destacado -->
                                </div>
                            </div>
                            <div id="payment-button-container" class="mt-6 min-h-[50px] relative">
                                 <!-- Botón checkout usa clases .btn .btn-primary -->
                                <button id="checkout-button" class="w-full btn btn-primary py-3 px-6 text-lg">
                                     <i class="fas fa-credit-card mr-2"></i> Proceder al Pago
                                </button>
                                <p id="payment-result-message" class="message mt-4 text-center"></p>
                            </div>
                        </div>
                        <div class="text-center mt-8">
                            <!-- Botón volver usa clases .btn .btn-gray -->
                            <button class="btn btn-gray admin-nav-item" data-section="products">
                                <i class="fas fa-arrow-left mr-2"></i> Seguir Comprando
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sección de Contacto -->
                 <div id="contact-section" style="display: none;">
                     <div class="max-w-4xl mx-auto">
                         <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Contáctanos</h2>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                             <!-- Formulario Contacto usa clase .contact-form -->
                            <div class="bg-white p-8 rounded-xl shadow-lg contact-form">
                                <h3 class="text-xl font-semibold text-gray-800 mb-6">Envía un mensaje</h3>
                                <form id="contactForm" class="space-y-6">
                                    <div id="contact-message-response" class="message mb-4"></div>
                                    <div>
                                        <label for="contact-name" class="block text-gray-700 text-sm font-semibold mb-2">Nombre Completo</label>
                                        <input type="text" id="contact-name" name="name" class="w-full py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    <div>
                                        <label for="contact-email" class="block text-gray-700 text-sm font-semibold mb-2">Correo Electrónico</label>
                                        <input type="email" id="contact-email" name="email" class="w-full py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    <div>
                                        <label for="contact-subject" class="block text-gray-700 text-sm font-semibold mb-2">Asunto</label>
                                        <input type="text" id="contact-subject" name="subject" class="w-full py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    <div>
                                        <label for="contact-message" class="block text-gray-700 text-sm font-semibold mb-2">Mensaje</label>
                                        <textarea id="contact-message" name="message" rows="5" class="w-full py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                                    </div>
                                    <div>
                                         <!-- Botón enviar usa clases .btn .btn-primary -->
                                        <button type="submit" id="contactSubmitButton" class="w-full py-3 px-4 btn btn-primary">
                                            Enviar Mensaje
                                        </button>
                                    </div>
                                </form>
                            </div>
                             <!-- Info Contacto usa clase .contact-form -->
                             <div class="bg-white p-8 rounded-xl shadow-lg contact-form">
                                 <h3 class="text-xl font-semibold text-gray-800 mb-6">Información de Contacto</h3>
                                 <div class="space-y-6">
                                      <div class="flex items-start">
                                          <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600"> <!-- Icono destacado -->
                                              <i class="fas fa-map-marker-alt"></i>
                                          </div>
                                          <div class="ml-4">
                                              <h4 class="text-lg font-semibold text-gray-800">Dirección</h4>
                                              <p class="mt-1 text-gray-600">Calle Principal #123, Ciudad</p>
                                          </div>
                                      </div>
                                     <div class="flex items-start">
                                          <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                                             <i class="fas fa-phone-alt"></i>
                                          </div>
                                          <div class="ml-4">
                                             <h4 class="text-lg font-semibold text-gray-800">Teléfono</h4>
                                             <p class="mt-1 text-gray-600">+57 123 456 7890</p>
                                             <p class="mt-1 text-gray-600 text-sm">Lunes a Viernes: 8am - 6pm</p>
                                          </div>
                                     </div>
                                     <div class="flex items-start">
                                          <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                                             <i class="fas fa-envelope"></i>
                                          </div>
                                          <div class="ml-4">
                                             <h4 class="text-lg font-semibold text-gray-800">Correo Electrónico</h4>
                                             <p class="mt-1 text-gray-600 break-all">contacto@ferremax.com</p> <!-- break-all por si es largo -->
                                          </div>
                                      </div>
                                     <div class="flex items-start">
                                           <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                                               <i class="fas fa-clock"></i>
                                           </div>
                                           <div class="ml-4">
                                               <h4 class="text-lg font-semibold text-gray-800">Horario de Atención</h4>
                                               <p class="mt-1 text-gray-600">Lunes a Viernes: 8am - 6pm</p>
                                               <p class="mt-1 text-gray-600">Sábados: 9am - 2pm</p>
                                           </div>
                                       </div>
                                 </div>
                                 <!-- Redes Sociales -->
                                <div class="mt-8">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Síguenos en redes sociales</h4>
                                    <div class="flex space-x-4">
                                        <a href="#" class="h-10 w-10 rounded-full bg-blue-600 text-white flex items-center justify-center hover:bg-blue-700 transition duration-150 ease-in-out" title="Facebook">
                                            <i class="fab fa-facebook-f"></i>
                                        </a>
                                        <a href="#" class="h-10 w-10 rounded-full bg-blue-400 text-white flex items-center justify-center hover:bg-blue-500 transition duration-150 ease-in-out" title="Twitter">
                                            <i class="fab fa-twitter"></i>
                                        </a>
                                        <a href="#" class="h-10 w-10 rounded-full bg-pink-600 text-white flex items-center justify-center hover:bg-pink-700 transition duration-150 ease-in-out" title="Instagram">
                                            <i class="fab fa-instagram"></i>
                                        </a>
                                         <a href="#" class="h-10 w-10 rounded-full bg-red-600 text-white flex items-center justify-center hover:bg-red-700 transition duration-150 ease-in-out" title="YouTube">
                                            <i class="fab fa-youtube"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Sección de Políticas -->
                <div id="policies-section" style="display: none;">
                     <div class="max-w-4xl mx-auto">
                        <h2 class="text-3xl font-bold text-gray-800 mb-10 text-center">Políticas de la Empresa</h2>
                        <div class="space-y-6">
                             <!-- Política item usa clase .policy-item y fade-in -->
                            <div class="policy-item fade-in">
                                <h3 class="text-2xl font-semibold mb-4 flex items-center">
                                    <i class="fas fa-lock text-blue-600 mr-3"></i> Política de Privacidad <!-- Icono en política -->
                                </h3>
                                <p>En Ferretería Ferremax, nos tomamos muy en serio la privacidad de nuestros clientes. Toda la información personal que recopilamos es utilizada exclusivamente para brindarte el mejor servicio posible y no será compartida con terceros sin tu consentimiento. Nos comprometemos a proteger tus datos personales y a cumplir con las leyes de protección de datos vigentes.</p>
                            </div>
                             <div class="policy-item fade-in" style="animation-delay: 0.1s;">
                                <h3 class="text-2xl font-semibold mb-4 flex items-center">
                                    <i class="fas fa-exchange-alt text-green-600 mr-3"></i> Política de Devoluciones
                                </h3>
                                <p>Ofrecemos un período de 30 días para devoluciones en productos defectuosos o no satisfactorios. Para iniciar una devolución, contáctanos a través de nuestro formulario de contacto y te proporcionaremos las instrucciones necesarias. Los productos deben estar en su estado original y con el embalaje completo para ser aceptados.</p>
                            </div>
                            <div class="policy-item fade-in" style="animation-delay: 0.2s;">
                                 <h3 class="text-2xl font-semibold mb-4 flex items-center">
                                    <i class="fas fa-truck text-orange-500 mr-3"></i> Política de Envío
                                </h3>
                                <p>Realizamos envíos a nivel nacional con costos adicionales según la ubicación. Los tiempos de entrega varían entre 3 y 7 días hábiles, dependiendo del destino. Los costos de envío serán calculados al momento de la compra y se añadirán al total del pedido. Si hay algún retraso en el envío, te informaremos lo antes posible.</p>
                            </div>
                            <div class="policy-item fade-in" style="animation-delay: 0.3s;">
                                 <h3 class="text-2xl font-semibold mb-4 flex items-center">
                                    <i class="fas fa-shield-alt text-purple-600 mr-3"></i> Política de Seguridad
                                </h3>
                                <p>Utilizamos tecnología de encriptación avanzada para proteger tus datos personales y de pago durante las transacciones. Implementamos medidas de seguridad para evitar accesos no autorizados y garantizar la integridad de tu información. Si tienes alguna duda sobre nuestras medidas de seguridad, no dudes en contactarnos.</p>
                            </div>
                             <div class="policy-item fade-in" style="animation-delay: 0.4s;">
                                 <h3 class="text-2xl font-semibold mb-4 flex items-center">
                                    <i class="fas fa-headset text-red-500 mr-3"></i> Política de Atención al Cliente
                                </h3>
                                <p>Nos comprometemos a ofrecer un excelente servicio al cliente. Si tienes preguntas o inquietudes, nuestro equipo de atención al cliente está disponible para asistirte. Puedes contactarnos a través del formulario de contacto en nuestra página o por correo electrónico. Responderemos a tus consultas en un plazo de 24 horas hábiles.</p>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Sección de Administración -->
                <div id="admin-section-container" style="display: none;">
                    <!-- Sección de Productos Admin -->
                     <div id="admin-products-section" style="display: none;">
                         <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                            <h2 class="text-3xl font-bold text-gray-800 mb-4 md:mb-0">Panel de Administración - Productos</h2>
                             <!-- Botón añadir producto usa clases .btn .btn-primary -->
                            <button id="add-product-button" class="btn btn-primary flex items-center">
                                <i class="fas fa-plus mr-2"></i> Añadir Producto
                            </button>
                        </div>

                        <!-- Formulario Añadir/Editar Producto -->
                        <div id="admin-add-edit-product-form-container" style="display: none;" class="mb-8">
                            <h3 id="admin-form-title" class="text-2xl font-semibold text-gray-800 mb-6">Añadir/Editar Producto</h3>
                            <form id="admin-product-form">
                                <input type="hidden" id="admin-product-id" name="productId">
                                <div id="admin-product-form-message" class="message mb-4"></div>
                                 <!-- Grid para formulario -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="admin-product-name">Nombre (*)</label>
                                        <input type="text" id="admin-product-name" name="Nombre" required>
                                    </div>
                                    <div>
                                        <label for="admin-product-brand">Marca (*)</label>
                                        <input type="text" id="admin-product-brand" name="Marca" required>
                                    </div>
                                    <div>
                                        <label for="admin-product-price">Precio (*)</label>
                                        <input type="number" id="admin-product-price" name="precio_unitario" required step="0.01" min="0">
                                    </div>
                                    <div>
                                        <label for="admin-product-quantity">Cantidad (*)</label>
                                        <input type="number" id="admin-product-quantity" name="cantidad" required step="1" min="0">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="admin-product-description">Descripción</label>
                                        <textarea id="admin-product-description" name="Descripcion"></textarea>
                                    </div>
                                     <div>
                                        <label for="admin-product-category">Categoría</label>
                                        <select id="admin-product-category" name="ID_Categoria">
                                            <option value="">-- Selecciona Categoría --</option>
                                            <!-- Categorías se cargarán con JS -->
                                        </select>
                                    </div>
                                    <div>
                                        <label for="admin-product-barcode">Cód. Barras</label>
                                        <input type="text" id="admin-product-barcode" name="Codigo_Barras">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="admin-product-image-url">URL Imagen</label>
                                        <input type="text" id="admin-product-image-url" name="imagen_url" placeholder="https://ejemplo.com/imagen.jpg">
                                        <p class="text-xs text-gray-500 mt-1">Pega la URL completa de la imagen.</p>
                                    </div>
                                </div>
                                <!-- Botones Formulario -->
                                <div class="form-buttons">
                                    <button type="button" id="admin-cancel-edit-product" class="btn btn-gray">Cancelar</button>
                                    <button type="submit" id="admin-save-product-button" class="btn btn-primary">Guardar</button> <!-- Estilo primario para guardar -->
                                </div>
                            </form>
                        </div>

                        <!-- Lista de Productos Admin -->
                        <div id="admin-product-list-container">
                            <div id="admin-products-message" class="message mb-4"></div>
                             <!-- Contenedor tabla admin -->
                            <div id="admin-products-table-container" class="overflow-x-auto bg-white rounded-lg shadow">
                                <p class="p-4 text-center text-gray-500">Cargando productos...</p>
                                <!-- Tabla se renderizará aquí -->
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Personalización Admin -->
                    <div id="admin-personalize-section" style="display: none;">
                         <h2 class="text-3xl font-bold text-gray-800 mb-8">Panel de Administración - Personalizar Sitio</h2>
                         <div id="admin-personalize-message" class="message mb-6"></div>
                         <form id="personalize-form">
                              <!-- Contenedor personalización -->
                            <div class="bg-white p-8 rounded-xl shadow-md space-y-8 border border-gray-200">
                                <!-- Sección Colores -->
                                <div>
                                    <h3 class="text-xl font-semibold text-gray-700 mb-6 border-b pb-2">Colores Principales</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
                                        <div class="color-input-group">
                                            <label for="setting-colorPrimary" class="mr-2">Primario:</label>
                                            <input type="color" id="setting-colorPrimary" name="colorPrimary" value="#2563eb">
                                        </div>
                                        <div class="color-input-group">
                                            <label for="setting-colorSecondary" class="mr-2">Secundario:</label>
                                            <input type="color" id="setting-colorSecondary" name="colorSecondary" value="#059669">
                                        </div>
                                        <div class="color-input-group">
                                            <label for="setting-colorAccent" class="mr-2">Acento:</label>
                                            <input type="color" id="setting-colorAccent" name="colorAccent" value="#f8fafc">
                                        </div>
                                    </div>
                                    <div class="mt-8 text-right">
                                        <button type="button" id="save-colors-button" class="btn btn-primary">Guardar Colores</button>
                                    </div>
                                </div>
                                 <!-- Sección Textos -->
                                <div>
                                    <h3 class="text-xl font-semibold text-gray-700 mb-6 border-b pb-2">Textos Clave</h3>
                                    <div class="space-y-6">
                                        <div>
                                            <label for="setting-welcomeTitle">Título Bienvenida (Home)</label>
                                            <input type="text" id="setting-welcomeTitle" name="welcomeTitle" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                                        </div>
                                        <div>
                                            <label for="setting-promoBannerTitle">Título Banner Promocional</label>
                                            <input type="text" id="setting-promoBannerTitle" name="promoBannerTitle" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                                        </div>
                                        <div>
                                            <label for="setting-promoBannerText">Texto Banner Promocional</label>
                                            <textarea id="setting-promoBannerText" name="promoBannerText" rows="3" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
                                        </div>
                                    </div>
                                     <div class="mt-8 text-right">
                                        <button type="button" id="save-texts-button" class="btn btn-primary">Guardar Textos</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

            </main>
        </section>

    </div> <!-- End flex-grow -->

    <!-- Footer del Archivo 2 -->
    <footer class="main-footer bg-gray-900 text-white py-8 mt-auto">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
             <!-- Footer con múltiples columnas -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Columna 1: Logo y Descripción -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Ferremax</h3>
                    <p class="text-gray-400 text-sm">Tu ferretería de confianza con los mejores productos y precios.</p>
                     <!-- Redes Sociales en Footer -->
                     <div class="flex space-x-4 mt-4">
                        <a href="#" class="text-gray-400 hover:text-white" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white" title="Instagram"><i class="fab fa-instagram"></i></a>
                         <a href="#" class="text-gray-400 hover:text-white" title="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                 <!-- Columna 2: Enlaces Rápidos -->
                 <div>
                     <h4 class="text-md font-semibold mb-4">Enlaces Rápidos</h4>
                     <ul class="space-y-2">
                         <li><a href="#" class="text-gray-400 hover:text-white text-sm admin-nav-item" data-section="home">Inicio</a></li>
                         <li><a href="#" class="text-gray-400 hover:text-white text-sm admin-nav-item" data-section="products">Productos</a></li>
                         <li><a href="#" class="text-gray-400 hover:text-white text-sm admin-nav-item" data-section="contact">Contacto</a></li>
                         <li><a href="#" class="text-gray-400 hover:text-white text-sm admin-nav-item" data-section="cart">Carrito</a></li>
                     </ul>
                 </div>
                 <!-- Columna 3: Políticas -->
                  <div>
                     <h4 class="text-md font-semibold mb-4">Información</h4>
                     <ul class="space-y-2">
                         <li><a href="#" class="text-gray-400 hover:text-white text-sm admin-nav-item" data-section="policies">Políticas</a></li>
                         <li><a href="#" class="text-gray-400 hover:text-white text-sm">Términos y Condiciones</a></li>
                         <li><a href="#" class="text-gray-400 hover:text-white text-sm">Preguntas Frecuentes</a></li>
                     </ul>
                 </div>
                 <!-- Columna 4: Contacto -->
                 <div>
                      <h4 class="text-md font-semibold mb-4">Contacto</h4>
                      <p class="text-gray-400 text-sm mb-2 flex items-center"><i class="fas fa-map-marker-alt w-4 mr-2"></i> Calle Principal #123</p>
                      <p class="text-gray-400 text-sm mb-2 flex items-center"><i class="fas fa-phone-alt w-4 mr-2"></i> +57 123 456 7890</p>
                      <p class="text-gray-400 text-sm flex items-center"><i class="fas fa-envelope w-4 mr-2"></i> contacto@ferremax.com</p>
                 </div>
            </div>
            <!-- Copyright -->
             <div class="text-center text-gray-500 border-t border-gray-700 mt-8 pt-6 text-sm">
                &copy; <span id="current-year"></span> Ferremax - Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <!-- ====================================================== -->
    <!--      INICIO: JavaScript del Archivo 1 (Original)     -->
    <!-- ====================================================== -->
    <script>
        "use strict";
        console.log("--- Script Ferremax V19 (Conectado a Render) Iniciado ---");

        // Variables globales para configuración (se llenarán desde el backend)
        let wompiPublicKey = null;
        let frontendBaseUrl = null;
        let configLoaded = false;

        // *** CAMBIO CLAVE: URL del Backend ahora apunta a Render ***
        const API_URL = "https://ferremax-actualizado.onrender.com"; // ¡URL pública de tu backend!

        // Constantes y Variables Globales (DOM, etc.)
        const loginSection = document.getElementById("login-section"),
            registerSection = document.getElementById("register-section"),
            mainContent = document.getElementById("main-content"),
            pageContent = document.getElementById("page-content"),
            featuredProductsContainer = document.getElementById("featured-products-container"),
            productsDisplayArea = document.getElementById("products-display-area"),
            contactForm = document.getElementById("contactForm"),
            contactMessageResponseDiv = document.getElementById("contact-message-response"),
            contactSubmitButton = document.getElementById("contactSubmitButton"),
            loginForm = document.getElementById("loginForm"),
            registerForm = document.getElementById("registerForm"),
            logoutButton = document.getElementById("logoutButton"),
            logoutButtonMobile = document.getElementById("logoutButtonMobile"),
            showRegisterLink = document.getElementById("show-register"),
            showLoginLink = document.getElementById("show-login"),
            navLinks = document.querySelectorAll(".admin-nav-item"),
            mobileMenuButton = document.getElementById("mobile-menu-button"),
            mobileMenu = document.getElementById("mobile-menu"),
            loginMessageDiv = document.getElementById("login-message"), // Usa la ID del HTML del archivo 2
            registerMessageDiv = document.getElementById("register-message"), // Usa la ID del HTML del archivo 2
            categoryGridContainer = document.getElementById('category-grid-container'),
            adminMenuDesktopContainer = document.getElementById('admin-menu-desktop-container'),
            adminMenuDesktopButton = document.getElementById('admin-menu-desktop-button'),
            adminMenuDesktopDropdown = document.getElementById('admin-menu-desktop-dropdown'),
            adminMenuMobileContainer = document.getElementById('admin-menu-mobile-container'),
            adminSectionContainer = document.getElementById('admin-section-container'),
            adminProductsSection = document.getElementById('admin-products-section'),
            adminPersonalizeSection = document.getElementById('admin-personalize-section'),
            adminProductsTableContainer = document.getElementById('admin-products-table-container'),
            adminProductsMessageDiv = document.getElementById('admin-products-message'),
            addProductButton = document.getElementById('add-product-button'),
            adminProductFormContainer = document.getElementById('admin-add-edit-product-form-container'),
            adminProductForm = document.getElementById('admin-product-form'),
            adminCancelButton = document.getElementById('admin-cancel-edit-product'),
            adminProductListContainer = document.getElementById('admin-product-list-container'),
            adminProductFormMessageDiv = document.getElementById('admin-product-form-message'),
            adminCategorySelect = document.getElementById('admin-product-category'),
            adminFormTitle = document.getElementById('admin-form-title'),
            adminProductIdInput = document.getElementById('admin-product-id'),
            adminSaveButton = document.getElementById('admin-save-product-button'),
            adminPersonalizeMessageDiv = document.getElementById('admin-personalize-message'),
            colorPrimaryInput = document.getElementById('setting-colorPrimary'),
            colorSecondaryInput = document.getElementById('setting-colorSecondary'),
            colorAccentInput = document.getElementById('setting-colorAccent'),
            welcomeTitleInput = document.getElementById('setting-welcomeTitle'),
            promoBannerTitleInput = document.getElementById('setting-promoBannerTitle'),
            promoBannerTextInput = document.getElementById('setting-promoBannerText'),
            saveColorsButton = document.getElementById('save-colors-button'),
            saveTextsButton = document.getElementById('save-texts-button'),
            mainWelcomeTitle = document.getElementById('main-welcome-title'),
            mainPromoTitle = document.getElementById('main-promo-title'),
            mainPromoText = document.getElementById('main-promo-text'),
            carouselSlidesContainer = document.querySelector('.carousel-slides'),
            carouselPrevButton = document.querySelector('.carousel-button.prev'),
            carouselNextButton = document.querySelector('.carousel-button.next');

        const cartSection = document.getElementById('cart-section'),
            cartItemsContainer = document.getElementById('cart-items-container'),
            cartSummaryAndCheckout = document.getElementById('cart-summary-and-checkout'),
            cartSubtotalSpan = document.getElementById('cart-subtotal'),
            cartTotalSpan = document.getElementById('cart-total'),
            cartItemCountDesktop = document.getElementById('cart-item-count-desktop'),
            cartItemCountMobileIcon = document.getElementById('cart-item-count-mobile-icon'),
            cartItemCountMobileMenu = document.getElementById('cart-item-count-mobile-menu'),
            checkoutButton = document.getElementById('checkout-button'),
            paymentButtonContainer = document.getElementById('payment-button-container'),
            cartCheckoutMessage = document.getElementById('payment-result-message'), // Reutiliza el message del payment
            cartMessageDiv = document.getElementById('cart-message');

        const CART_STORAGE_KEY = 'ferremaxCart';
        let allProducts = [];
        let productsLoaded = false;
        let currentSettings = {};

        // Categorías (igual al archivo 1)
        const categoriesData = [
             { name: "Eléctricas", icon: "fa-solid fa-plug-circle-bolt", id: "electricas" },
             { name: "Manuales", icon: "fa-solid fa-wrench", id: "manuales" },
             { name: "Seguridad", icon: "fa-solid fa-hard-hat", id: "seguridad" },
             { name: "Medición", icon: "fa-solid fa-ruler-combined", id: "medicion" },
             { name: "Tornillería", icon: "fa-solid fa-screwdriver-wrench", id: "tornilleria" },
             { name: "Jardinería", icon: "fa-solid fa-leaf", id: "jardineria" }
        ];

        // Variables Carrusel (igual al archivo 1)
        let currentSlideIndex = 0;
        let slideInterval;
        const SLIDE_INTERVAL_TIME = 4000;
        let slides = [];

        // --- Funciones Auxiliares (iguales al archivo 1) ---
        function showMessage(element, message, isError = true) {
             if (!element) { console.warn("showMessage: Elemento nulo."); return; }
             element.textContent = message;
             // Usa las clases CSS del archivo 2 para mensajes
             element.className = `message ${isError ? 'message-error' : 'message-success'} p-4 text-sm rounded-md`; // Añade padding y tamaño
             element.style.display = "block";
             const persistentIds = ["admin-products-message", "admin-product-form-message", "admin-personalize-message", "payment-result-message", "cart-message", "login-message", "register-message"]; // Añadidos login/register
             if (!persistentIds.includes(element.id)) {
                setTimeout(() => {
                    if (element && element.style.display !== 'none' && element.textContent === message) {
                         // Fade out opcional
                        // element.style.opacity = '0';
                        // setTimeout(() => element.style.display = 'none', 300); // Ocultar tras fade out
                         element.style.display = 'none';
                    }
                }, 4000);
            }
        }

        function hideMessages(specificElement = null) {
            if (specificElement) {
                if (specificElement.style) specificElement.style.display = 'none';
            } else {
                 // Selecciona elementos .message dentro de #page-content o en las secciones login/register
                document.querySelectorAll("#page-content .message, #login-section .message, #register-section .message").forEach(msg => {
                     const persistentIds = ["admin-products-message", "admin-product-form-message", "admin-personalize-message", "payment-result-message", "cart-message", "login-message", "register-message"];
                    if (!persistentIds.includes(msg.id)) {
                        msg.style.display = 'none';
                    }
                });
            }
        }

        // darkenColor es usado por applyColorSettings, se mantiene igual
        function darkenColor(hex, percent) {
            try {
                hex = hex.replace(/^#/, "");
                if (hex.length === 3) hex = hex.split("").map(c => c + c).join("");
                let r = parseInt(hex.substring(0, 2), 16);
                let g = parseInt(hex.substring(2, 4), 16);
                let b = parseInt(hex.substring(4, 6), 16);
                const factor = 1 - percent / 100;
                r = Math.max(0, Math.floor(r * factor));
                g = Math.max(0, Math.floor(g * factor));
                b = Math.max(0, Math.floor(b * factor));
                return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            } catch (e) {
                console.error("Error darkenColor:", hex, e);
                return hex;
            }
        }


        // --- Funciones del Carrito (iguales al archivo 1, pero adaptadas al renderizado del archivo 2) ---
        function getCart() {
            const c = localStorage.getItem(CART_STORAGE_KEY);
            try {
                const p = c ? JSON.parse(c) : [];
                return Array.isArray(p) ? p.filter(item => item && typeof item.productId !== 'undefined' && item.productId !== null) : [];
            } catch (e) {
                console.error("Error getCart:", e);
                localStorage.removeItem(CART_STORAGE_KEY);
                return [];
            }
        }

        function saveCart(cart) {
            if (!Array.isArray(cart)) { console.warn("saveCart: Intento de guardar algo que no es un array."); return; }
            localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
            updateCartIcon();
            if (cartSection && cartSection.style.display !== 'none') { renderCartPage(); }
        }

        function addToCart(productId, quantity = 1, buttonElement = null) {
            console.log(`[Cart] Add: ${productId} Qty: ${quantity}`);
            if (!allProducts || allProducts.length === 0) {
                console.error("Cart Error: Products not loaded.");
                showMessage(cartMessageDiv || pageContent?.querySelector('.message') || pageContent, 'Error: Info producto no disponible.', true);
                return;
            }
            let cart = getCart();
            const product = allProducts.find(p => p.ID_Producto == productId);
            if (!product) {
                console.error("Cart Error: Product not found:", productId);
                showMessage(cartMessageDiv || pageContent?.querySelector('.message') || pageContent, 'Error: Producto no encontrado.', true);
                return;
            }
            const stock = product.cantidad ?? 0;
            const existingItemIndex = cart.findIndex(item => item.productId == productId);

            if (stock <= 0 && existingItemIndex === -1) {
                showMessage(cartMessageDiv || pageContent?.querySelector('.message') || pageContent, `"${product.Nombre}" agotado.`, true);
                 if (buttonElement) { // Feedback visual en botón
                    buttonElement.disabled = true;
                    buttonElement.innerHTML = '<i class="fas fa-times-circle mr-2"></i>Sin Stock';
                    buttonElement.classList.remove('btn-primary'); // Asume que era primario
                    buttonElement.classList.add('btn-gray', 'cursor-not-allowed'); // Usa clases de botón archivo 2
                }
                return;
            }

            let addedQty = 0;
            if (existingItemIndex > -1) {
                const currentQty = cart[existingItemIndex].quantity;
                const potentialQty = currentQty + quantity;
                if (potentialQty > stock) {
                    addedQty = stock - currentQty;
                    if (addedQty > 0) {
                        cart[existingItemIndex].quantity = stock;
                         showMessage(cartMessageDiv || pageContent?.querySelector('.message') || pageContent, `Stock máx (${stock}) alcanzado para "${product.Nombre}".`, true);
                    } else {
                         showMessage(cartMessageDiv || pageContent?.querySelector('.message') || pageContent, `Ya tienes el stock máx (${stock}) de "${product.Nombre}".`, true);
                    }
                } else {
                    cart[existingItemIndex].quantity = potentialQty;
                    addedQty = quantity;
                }
            } else {
                if (quantity > stock) {
                    addedQty = stock;
                    if (addedQty > 0) {
                        cart.push({
                            productId: parseInt(productId),
                            quantity: stock,
                            price: product.precio_unitario,
                            name: product.Nombre,
                            imageUrl: product.imagen_url,
                            stock: stock
                        });
                         showMessage(cartMessageDiv || pageContent?.querySelector('.message') || pageContent, `Stock insuf (${stock}) para "${product.Nombre}". Añadido: ${addedQty}.`, true);
                    } else {
                         showMessage(cartMessageDiv || pageContent?.querySelector('.message') || pageContent, `"${product.Nombre}" agotado.`, true);
                    }
                } else {
                    addedQty = quantity;
                    cart.push({
                        productId: parseInt(productId),
                        quantity: quantity,
                        price: product.precio_unitario,
                        name: product.Nombre,
                        imageUrl: product.imagen_url,
                        stock: stock
                    });
                }
            }

            if (addedQty > 0) {
                saveCart(cart);
                 if (buttonElement && !buttonElement.classList.contains('added-feedback')) { // Evitar múltiples timeouts si se clickea rápido
                     const originalHtml = buttonElement.innerHTML;
                     const originalClasses = buttonElement.className;
                     buttonElement.disabled = true;
                     buttonElement.innerHTML = '<i class="fas fa-check mr-1"></i> Añadido'; // Feedback
                     buttonElement.classList.add('added-feedback', 'btn-secondary'); // Usa clase feedback y botón secundario
                     buttonElement.classList.remove('btn-primary');

                     setTimeout(() => {
                         if (buttonElement?.classList.contains('added-feedback')) {
                             // Re-evaluar estado al restaurar
                             const latestP = allProducts.find(p => p.ID_Producto == productId);
                             const latestC = getCart().find(i => i.productId == productId);
                             const currentStock = latestP?.cantidad ?? 0;
                             const cartQty = latestC?.quantity ?? 0;
                             const isStillOutOfStock = cartQty >= currentStock;

                             buttonElement.innerHTML = originalHtml; // Restaurar HTML
                             buttonElement.className = originalClasses; // Restaurar Clases
                             buttonElement.classList.remove('added-feedback'); // Quitar clase feedback

                             buttonElement.disabled = isStillOutOfStock; // Deshabilitar si sigue sin stock
                             if (isStillOutOfStock) {
                                 buttonElement.innerHTML = '<i class="fas fa-times-circle mr-2"></i>Sin Stock';
                                 buttonElement.classList.remove('btn-primary');
                                 buttonElement.classList.add('btn-gray', 'cursor-not-allowed');
                             }
                         }
                     }, 1500); // Tiempo del feedback
                 } else if (!buttonElement) { // Si no hay botón (ej. añadido desde detalle?)
                     showMessage(cartMessageDiv || pageContent?.querySelector('.message') || pageContent, '¡Producto añadido!', false);
                 }
             }
        }


        function removeFromCart(productId) {
            console.log(`[Cart] Remove: ${productId}`);
            let cart = getCart();
            const initialLength = cart.length;
            cart = cart.filter(item => item.productId != productId);
            if (cart.length < initialLength) {
                console.log(`[Cart] Item ${productId} removed successfully.`);
                saveCart(cart);
            } else {
                console.warn(`[Cart] Item ${productId} not found to remove.`);
            }
        }

        function updateCartQuantity(productId, newQuantity) {
            console.log(`[Cart] Update Qty: ${productId} -> ${newQuantity}`);
            const quantityNum = parseInt(newQuantity);
            if (isNaN(quantityNum) || quantityNum < 0) {
                console.warn("Cart Update: Invalid qty", newQuantity);
                renderCartPage(); // Re-render para corregir input inválido
                return;
            }
            let cart = getCart();
            const itemIndex = cart.findIndex(item => item.productId == productId);
            if (itemIndex > -1) {
                const stock = cart[itemIndex].stock || 0;
                if (quantityNum === 0) {
                    removeFromCart(productId);
                } else if (quantityNum > stock) {
                    cart[itemIndex].quantity = stock;
                    saveCart(cart);
                     showMessage(cartMessageDiv, `Stock máx (${stock}) para "${cart[itemIndex].name}".`, true);
                } else {
                    cart[itemIndex].quantity = quantityNum;
                    saveCart(cart);
                    hideMessages(cartMessageDiv); // Oculta mensajes si la actualización fue válida
                }
            } else {
                console.warn("Cart Update: Item not found", productId);
            }
             // Actualizar total visualmente sin recargar toda la página (opcional pero mejora UX)
             const { subtotal, total } = calculateCartTotals();
             if(cartSubtotalSpan) cartSubtotalSpan.textContent = `$${subtotal.toFixed(2)}`;
             if(cartTotalSpan) cartTotalSpan.textContent = `$${total.toFixed(2)}`;
             // También podrías actualizar el total del item específico que cambió
        }


        function calculateCartTotals() {
            const cart = getCart();
            let subtotal = 0;
            cart.forEach(item => {
                subtotal += (parseFloat(item.price) || 0) * (parseInt(item.quantity) || 0);
            });
            // Aquí podrías añadir lógica de envío, impuestos, etc. si fuera necesario
            return { subtotal, total: subtotal }; // Por ahora, total = subtotal
        }

        function updateCartIcon() {
            const cart = getCart();
            const totalItems = cart.reduce((sum, item) => sum + (parseInt(item.quantity) || 0), 0);
            const counts = [cartItemCountDesktop, cartItemCountMobileIcon, cartItemCountMobileMenu];
            counts.forEach(el => {
                if (el) {
                    el.textContent = totalItems;
                    el.style.display = totalItems > 0 ? 'inline-block' : 'none'; // 'inline-block' es más flexible que 'flex'
                }
            });
        }

        // renderCartPage adaptada para usar clases de estilo del Archivo 2
        function renderCartPage() {
            console.log("[Cart] Rendering page...");
            if (!cartItemsContainer || !cartSummaryAndCheckout || !cartSubtotalSpan || !cartTotalSpan) {
                console.error("Cart Render: Missing DOM elements");
                if(pageContent) pageContent.innerHTML = '<p class="text-red-600 text-center p-4">Error interno al mostrar el carrito.</p>';
                return;
            }
            const cart = getCart();
            console.log("[Cart] Data from getCart() for render:", JSON.stringify(cart));

            cartItemsContainer.innerHTML = ""; // Limpiar contenedor

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-center text-gray-500 py-6">Tu carrito está vacío.</p>'; // Mensaje vacío estilizado
                cartSummaryAndCheckout.style.display = 'none';
                if (checkoutButton) checkoutButton.style.display = 'none';
                 hideMessages(cartMessageDiv); // Ocultar mensajes si el carrito está vacío ahora
            } else {
                const { subtotal, total } = calculateCartTotals();
                cart.forEach(item => {
                    if (!item || typeof item.productId === 'undefined' || item.productId === null) {
                        console.warn("[Cart Render] Ignorando item inválido:", item);
                        return;
                    }
                    const imageUrl = item.imageUrl || `https://placehold.co/70x70/e2e8f0/475569?text=NI`; // Placeholder con colores archivo 2
                    const imageOnError = `this.onerror=null;this.src='https://placehold.co/70x70/fecaca/b91c1c?text=Err';`; // Error placeholder
                    const priceF = (typeof item.price === 'number' ? item.price.toFixed(2) : 'N/A');
                    const itemTotalF = (typeof item.price === 'number' && typeof item.quantity === 'number' ? (item.price * item.quantity).toFixed(2) : 'N/A');
                    const stock = item.stock || 0;

                    const itemDiv = document.createElement('div');
                     // Clases Tailwind y CSS para el item del carrito
                    itemDiv.className = 'cart-item flex items-center justify-between border-b border-gray-200 py-4 last:border-b-0 flex-wrap gap-4'; // gap-4 para espacio responsivo

                    itemDiv.innerHTML = `
                        <div class="flex items-center flex-grow min-w-[200px]"> <!-- Contenedor imagen y nombre -->
                            <img src="${imageUrl}" alt="${item.name || ''}" class="cart-item-img" onerror="${imageOnError}"> <!-- Usa clase CSS .cart-item-img -->
                            <div>
                                <h4 class="font-semibold text-gray-800">${item.name || 'N/A'}</h4>
                                <p class="text-sm text-gray-600">Precio: $${priceF}</p>
                                <p class="text-xs text-gray-500 mt-1">Stock: ${stock}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3 sm:space-x-4"> <!-- Contenedor cantidad, total, eliminar -->
                            <label for="qty-${item.productId}" class="sr-only">Cantidad</label>
                             <input type="number" id="qty-${item.productId}" value="${item.quantity}" min="1" max="${stock}"
                                    data-product-id-qty="${item.productId}"
                                    class="cart-item-input w-16 text-center border rounded-md py-1 px-2"  aria-label="Cantidad">  <!-- Input estilizado -->

                            <p class="font-semibold w-20 text-right text-gray-700">$${itemTotalF}</p>
                            <button class="remove-item-btn cart-item-remove-button text-red-500 hover:text-red-700" data-product-id-remove="${item.productId}" title="Eliminar">
                                <i class="fas fa-trash-alt pointer-events-none"></i>
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemDiv);
                });

                cartSubtotalSpan.textContent = `$${subtotal.toFixed(2)}`;
                cartTotalSpan.textContent = `$${total.toFixed(2)}`;
                cartSummaryAndCheckout.style.display = 'block';
                if (checkoutButton) {
                    checkoutButton.style.display = 'block'; // O 'flex' si es un botón flex
                    checkoutButton.disabled = false;
                    checkoutButton.innerHTML = '<i class="fas fa-credit-card mr-2"></i> Proceder al Pago'; // Restaurar texto/icono
                    if(cartCheckoutMessage) hideMessages(cartCheckoutMessage);
                }
                 hideMessages(cartMessageDiv); // Ocultar mensajes generales del carrito si hay items
            }
        }


        // --- Funciones de Renderizado Público (iguales al archivo 1, pero adaptadas al HTML/CSS del archivo 2) ---

        // renderProductCard adaptado para clases CSS y hover del Archivo 2
        function renderProductCard(product, isFeatured = false) {
            const div = document.createElement("div");
             // Usa clase .product-card para hover, y clases Tailwind para layout/estilo base
             div.className = `product-card bg-white rounded-lg shadow-md overflow-hidden flex flex-col transition duration-300 border border-gray-200 hover:shadow-xl`; // Sombra hover más pronunciada

             const imageUrl = product.imagen_url || `https://placehold.co/300x200/e2e8f0/475569?text=NI`; // Placeholder archivo 2
             const imageOnError = `this.onerror=null;this.src='https://placehold.co/300x199/fecaca/b91c1c?text=Err';`;
             const price = typeof product.precio_unitario === 'number' ? `$${product.precio_unitario.toFixed(2)}` : 'N/A';
             const description = product.Descripcion ? (isFeatured ? product.Descripcion.substring(0, 50) + (product.Descripcion.length > 50 ? '...' : '') : product.Descripcion) : (isFeatured ? '' : 'N/A');
             const stock = product.cantidad ?? 0;
             const isOutOfStock = stock <= 0;

             div.innerHTML = `
                <div class="card-img-container product-detail-link cursor-pointer" data-product-id-detail="${product.ID_Producto}">
                    <img src="${imageUrl}" class="card-img-top" alt="${product.Nombre || ''}" onerror="${imageOnError}">
                </div>
                <div class="p-4 flex flex-col flex-grow"> <!-- Contenido card -->
                    <h5 class="text-lg font-semibold text-gray-800 truncate mb-1 product-detail-link cursor-pointer" title="${product.Nombre || ''}" data-product-id-detail="${product.ID_Producto}">
                        ${product.Nombre || 'N/A'}
                    </h5>
                     ${!isFeatured && description && description !== 'N/A' ? `<p class="text-gray-600 text-sm mb-2 mt-1 flex-grow min-h-[40px]">${description}</p>` : '<div class="flex-grow"></div>' /* Empuja precio/botón abajo si no hay desc */}
                     <p class="text-xl font-bold product-price mt-auto mb-3">${price}</p> <!-- Usa clase .product-price -->
                     <!-- Botón usa clases .btn del Archivo 2 -->
                     <button class="add-to-cart-button mt-auto w-full btn ${isOutOfStock ? 'btn-gray cursor-not-allowed' : 'btn-primary'}" data-product-id-add="${product.ID_Producto}" ${isOutOfStock ? 'disabled title="Sin stock"' : ''}>
                        ${isOutOfStock ? '<i class="fas fa-times-circle mr-2"></i>Sin Stock' : '<i class="fas fa-cart-plus mr-2"></i>Añadir'}
                    </button>
                </div>
            `;
             return div;
         }


        function renderProductGrid(container) {
            if (!container) return;
            container.innerHTML = "";
             // Clases Tailwind para el grid (iguales al archivo 1)
            container.className = "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8"; // Gap responsivo
            if (!allProducts || allProducts.length === 0) {
                container.innerHTML = '<p class="col-span-full text-center text-gray-500 p-4">No hay productos disponibles.</p>';
                return;
            }
            allProducts.forEach(p => container.appendChild(renderProductCard(p, false)));
        }

        function renderFeaturedProducts(container) {
            if (!container) return;
            container.innerHTML = "";
             // Clases Tailwind para grid destacado (igual al archivo 1)
            container.className = "grid grid-cols-1 md:grid-cols-3 gap-8"; // Gap mayor para destacados
            if (!allProducts || allProducts.length === 0) {
                container.innerHTML = '<p class="col-span-full text-center text-gray-500 p-4">No hay productos destacados.</p>';
                return;
            }
            const featured = allProducts.slice(0, 3); // Muestra los 3 primeros como destacados
            featured.forEach(p => container.appendChild(renderProductCard(p, true))); // isFeatured = true
        }

         // renderProductDetailContent adaptado para clases HTML/CSS del Archivo 2
        function renderProductDetailContent(container, product) {
            container.innerHTML = ""; // Limpiar contenedor
            const detailDiv = document.createElement("div");
            detailDiv.className = "product-detail-container"; // Usa la clase CSS del archivo 2

            const imageUrl = product.imagen_url || `https://placehold.co/600x400/e2e8f0/475569?text=NI`;
            const imageOnError = `this.onerror=null;this.src='https://placehold.co/600x399/fecaca/b91c1c?text=Err';`;
            const price = typeof product.precio_unitario === 'number' ? `$${product.precio_unitario.toFixed(2)}` : 'N/A';
            const stock = product.cantidad ?? 0;
            const isOutOfStock = stock <= 0;

            detailDiv.innerHTML = `
                 <div class="product-detail-image-container"> <!-- Contenedor imagen -->
                    <img src="${imageUrl}" class="product-detail-image" alt="${product.Nombre || ''}" onerror="${imageOnError}">
                </div>
                <div class="product-detail-info flex-grow"> <!-- Contenedor info -->
                    <h3 class="text-2xl lg:text-3xl font-bold text-gray-800 mb-3">${product.Nombre || 'N/A'}</h3>
                    <p class="text-gray-700 mb-4">${product.Descripcion || 'Descripción no disponible.'}</p>
                    <p class="text-sm text-gray-500 mb-2">Disponibles: <span class="font-medium text-gray-700">${stock}</span></p>
                    <p class="text-3xl font-bold product-price mb-6">${price}</p>
                     <!-- Botones usan clases .btn del Archivo 2 -->
                     <div class="flex flex-col sm:flex-row gap-4">
                         <button class="add-to-cart-button w-full sm:w-auto btn ${isOutOfStock ? 'btn-gray cursor-not-allowed' : 'btn-primary'} px-6 py-3" data-product-id-add="${product.ID_Producto}" ${isOutOfStock ? 'disabled title="Sin stock"' : ''}>
                            ${isOutOfStock ? '<i class="fas fa-times-circle mr-2"></i>Sin Stock' : '<i class="fas fa-cart-plus mr-2"></i>Añadir al Carrito'}
                        </button>
                         <button id="back-to-products" class="w-full sm:w-auto btn btn-accent px-6 py-3"> <!-- Botón volver usa accent -->
                            <i class="fas fa-arrow-left mr-2"></i>Volver a Productos
                        </button>
                     </div>
                </div>
            `;
            container.appendChild(detailDiv);

            const backBtn = detailDiv.querySelector("#back-to-products");
            if (backBtn) {
                backBtn.addEventListener("click", () => showPageSection("products"));
            }
             // Añadir listener al botón "Añadir al carrito" de la vista detalle
             const detailAddBtn = detailDiv.querySelector(".add-to-cart-button");
             if(detailAddBtn && !isOutOfStock) {
                 detailAddBtn.addEventListener('click', (e) => {
                     addToCart(e.currentTarget.dataset.productIdAdd, 1, e.currentTarget);
                 });
             }
        }


        // renderProductDetail (lógica fetch igual, llama a renderProductDetailContent adaptado)
        function renderProductDetail(container, productId) {
            if (!container) return;
            container.innerHTML = '<p class="text-center text-gray-500 p-4">Cargando detalle del producto...</p>'; // Mensaje carga
            container.className = ""; // Resetear clases previas del contenedor (ej. grid)

            const product = allProducts.find(p => p.ID_Producto == productId);
            if (product && productsLoaded) { // Si ya tenemos los productos cargados
                renderProductDetailContent(container, product);
            } else { // Si no, buscar por fetch
                fetch(`${API_URL}/api/productos/${productId}`)
                    .then(response => {
                        if (!response.ok) { return response.json().then(err => { throw new Error(err.message || `Error ${response.status}`) }); }
                        return response.json();
                    })
                    .then(p => {
                        if (!p || !p.ID_Producto) throw new Error('Producto no hallado en la respuesta.');
                        // Asegurar formato números
                        p.precio_unitario = parseFloat(p.precio_unitario) || 0;
                        p.cantidad = parseInt(p.cantidad) || 0;
                        renderProductDetailContent(container, p);
                    })
                    .catch(error => {
                        console.error("Error cargando detalle producto:", error);
                         container.innerHTML = `
                            <div class="text-center p-6 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                                <p class="font-semibold">Error al cargar el producto</p>
                                <p class="text-sm mt-1">(${error.message}).</p>
                                <button id="back-to-products-error" class="mt-4 btn btn-gray text-sm">Volver a Productos</button>
                            </div>`;
                        const btnErr = container.querySelector("#back-to-products-error");
                        if (btnErr) {
                            btnErr.addEventListener("click", () => showPageSection("products"));
                        }
                    });
            }
        }


        // renderCategories (adaptado para clases CSS del archivo 2)
        function renderCategories() {
            if (!categoryGridContainer) return;
            categoryGridContainer.innerHTML = ""; // Limpiar
            categoriesData.forEach(cat => {
                const card = document.createElement('div');
                card.className = 'category-card cursor-pointer transform hover:scale-105'; // Clases CSS y Tailwind archivo 2
                card.setAttribute('data-category-id', cat.id); // Usar categoría para filtrar si se implementa
                card.innerHTML = `<i class="${cat.icon} text-4xl mb-3"></i><span class="font-semibold block">${cat.name}</span>`; // Icono más grande y span con clases
                categoryGridContainer.appendChild(card);
            });
             // Añadir listener al contenedor (delegación de eventos)
            categoryGridContainer.addEventListener('click', handleCategoryClick);
        }


        // --- Funciones del Carrusel (iguales al archivo 1, adaptadas a CSS archivo 2) ---
        function createCarouselSlides() {
            if (!carouselSlidesContainer) { console.log("Carrusel: Contenedor no encontrado."); return; }

            // Solo recrear si los productos han cambiado o no hay slides
            if (!allProducts || allProducts.length === 0) {
                 carouselSlidesContainer.innerHTML = '<p class="text-gray-500 p-4 text-center">No hay imágenes para mostrar.</p>';
                 if(carouselPrevButton) carouselPrevButton.style.display = 'none';
                 if(carouselNextButton) carouselNextButton.style.display = 'none';
                 slides = []; // Limpiar slides si no hay productos
                 stopSlideInterval(); // Detener intervalo
                 return;
            }

            const productsForCarousel = allProducts.slice(0, 6); // Tomar hasta 6 productos

            // Evitar recrear si ya existen y son los mismos (simple check de longitud)
            if (slides.length === productsForCarousel.length && slides.length > 0) { return; }

            console.log("Creando carrusel...");
            carouselSlidesContainer.innerHTML = ""; // Limpiar
            slides = []; // Resetear array de slides

            productsForCarousel.forEach((p, i) => {
                const slide = document.createElement('div');
                 slide.className = 'carousel-slide'; // Clase base del CSS archivo 2
                slide.setAttribute('data-index', i);
                 const imgUrl = p.imagen_url || `https://placehold.co/400x200/e2e8f0/475569?text=Producto`;
                 const imgErr = `this.onerror=null;this.src='https://placehold.co/400x199/fecaca/b91c1c?text=Error';`;
                 // Estructura interna slide adaptada a CSS archivo 2
                 slide.innerHTML = `<img src="${imgUrl}" alt="${p.Nombre || ''}" onerror="${imgErr}" class="mb-4 rounded-lg shadow-md"><p class="text-lg font-semibold">${p.Nombre || 'Producto sin nombre'}</p>`;
                if (i === 0) slide.classList.add('active');
                carouselSlidesContainer.appendChild(slide);
                slides.push(slide);
            });

             // Mostrar/ocultar botones y iniciar intervalo
            if (slides.length > 1) {
                if (carouselPrevButton) carouselPrevButton.style.display = 'flex';
                if (carouselNextButton) carouselNextButton.style.display = 'flex';
                startSlideInterval();
            } else {
                if (carouselPrevButton) carouselPrevButton.style.display = 'none';
                if (carouselNextButton) carouselNextButton.style.display = 'none';
                stopSlideInterval();
            }

            if (slides.length > 0) {
                showSlide(currentSlideIndex); // Asegurarse que el primer slide se muestre
            }
        }


        function showSlide(index) {
            if (!carouselSlidesContainer || slides.length === 0) return;
            if (index >= slides.length) currentSlideIndex = 0;
            else if (index < 0) currentSlideIndex = slides.length - 1;
            else currentSlideIndex = index;
            // Actualizar clases 'active'
            slides.forEach((slide, i) => slide.classList.toggle('active', i === currentSlideIndex));
            // Mover contenedor de slides (opcional, si no se usa active)
            // carouselSlidesContainer.style.transform = `translateX(-${currentSlideIndex * 100}%)`;
        }

        function nextSlide() { showSlide(currentSlideIndex + 1); }
        function prevSlide() { showSlide(currentSlideIndex - 1); }
        function startSlideInterval() { stopSlideInterval(); if (slides.length > 1) { slideInterval = setInterval(nextSlide, SLIDE_INTERVAL_TIME); } }
        function stopSlideInterval() { clearInterval(slideInterval); }


        // --- Funciones de Carga de Datos (iguales al archivo 1) ---
        async function loadAndStorePublicProducts() {
            if (productsLoaded && allProducts.length > 0) return true;
            console.log("Cargando productos públicos...");
            try {
                const response = await fetch(`${API_URL}/api/productos`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                let products = await response.json();
                allProducts = products.map(p => ({ ...p, precio_unitario: parseFloat(p.precio_unitario) || 0, cantidad: parseInt(p.cantidad) || 0 }));
                productsLoaded = true;
                console.log(`Productos públicos cargados: ${allProducts.length}`);
                updateCartIcon(); // Actualizar icono carrito tras cargar productos
                return true;
            } catch (error) {
                console.error("Error cargando productos públicos:", error);
                allProducts = []; productsLoaded = false;
                if (productsDisplayArea) productsDisplayArea.innerHTML = '<p class="col-span-full text-red-600 p-4 text-center">Error al cargar productos.</p>';
                if (featuredProductsContainer) featuredProductsContainer.innerHTML = '<p class="col-span-full text-red-600 p-4 text-center">Error al cargar destacados.</p>';
                return false;
            }
        }

        async function loadSiteSettings() {
             // Evitar recargar si ya están cargados y aplicados (opcional)
             // if (Object.keys(currentSettings).length > 0) return true;
             console.log("Cargando settings del sitio...");
             try {
                 // Simular admin si es necesario para obtener settings (depende del backend)
                 const headers = { 'x-admin-simulated': 'true' }; // Asume que se necesita simular admin
                 const response = await fetch(`${API_URL}/api/admin/settings`, { headers });
                 if (!response.ok) throw new Error(`HTTP ${response.status}`);
                 const data = await response.json();
                 if (data.success && data.settings) {
                     console.log("Settings cargados:", data.settings);
                     currentSettings = data.settings;
                     applySiteSettings(); // Aplicar settings inmediatamente
                     return true;
                 } else {
                     throw new Error(data.message || "Respuesta inválida al cargar settings.");
                 }
             } catch (error) {
                 console.error("Error loadSiteSettings:", error);
                 currentSettings = {}; // Resetear a vacío en caso de error
                 applySiteSettings(); // Aplicar defaults (los del CSS inicial)
                 return false;
             }
         }

        async function loadAdminProducts() {
            if (!adminProductsTableContainer) { console.error("Error: Contenedor tabla admin no encontrado."); return; }
            adminProductsTableContainer.innerHTML = '<p class="p-4 text-gray-500 text-center">Cargando productos (admin)...</p>';
            hideMessages(adminProductsMessageDiv);
            console.log("Cargando productos para admin...");
            try {
                const headers = { 'x-admin-simulated': 'true' }; // Asume simulación admin
                const response = await fetch(`${API_URL}/api/admin/products`, { headers });
                if (!response.ok) { const errData = await response.json().catch(() => ({ message: `Error ${response.status}` })); throw new Error(errData.message || `Error ${response.status}`); }
                const products = await response.json();
                console.log(`Productos admin cargados: ${products?.length || 0}`);
                renderAdminProductTable(products);
            } catch (error) {
                console.error("Error loadAdminProducts:", error);
                 showMessage(adminProductsMessageDiv, `Error carga admin: ${error.message}`, true);
                adminProductsTableContainer.innerHTML = '<p class="p-4 text-red-600 text-center">No se pudieron cargar los productos.</p>';
            }
        }

        async function loadCategoriesIntoSelect() {
            if (!adminCategorySelect) return;
            // Evitar recargar si ya están (y no hay error)
            if (adminCategorySelect.options.length > 1 && !adminCategorySelect.querySelector('option[value="error"]')) { return; }
            console.log("Cargando categorías en select admin...");
            try {
                const response = await fetch(`${API_URL}/api/categories`); // Endpoint público de categorías
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const categories = await response.json();
                adminCategorySelect.innerHTML = '<option value="">-- Selecciona Categoría --</option>'; // Opción default
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.ID_Categoria;
                    option.textContent = cat.Nombre;
                    adminCategorySelect.appendChild(option);
                });
                console.log("Categorías cargadas en select.");
            } catch (error) {
                console.error("Error loadCategoriesIntoSelect:", error);
                adminCategorySelect.innerHTML = '<option value="error">Error al cargar categorías</option>';
                 showMessage(adminProductFormMessageDiv, 'Error: No se pudieron cargar las categorías.', true);
            }
        }


        // --- Funciones de Navegación y UI (iguales al archivo 1) ---
        async function showPageSection(sectionId, detailId = null) {
            console.log(`Nav -> ${sectionId}${detailId ? ` (${detailId})` : ''}`);
             hideMessages(); // Ocultar todos los mensajes no persistentes al cambiar sección

             const publicSections = ['home', 'products', 'contact', 'policies', 'cart'];
             const adminSubSections = ['admin-products', 'admin-personalize'];
             let needsPublicProducts = ['home', 'products', 'cart'].includes(sectionId) || (sectionId === 'products' && detailId);
             const isAdminSection = adminSubSections.includes(sectionId);

             // Ocultar todas las secciones principales primero
             document.querySelectorAll('#page-content > div[id$="-section"], #page-content > section[id$="-section"]').forEach(sec => {
                 if (sec) sec.style.display = 'none';
             });
              // Ocultar contenedor admin si no estamos en una sección admin
             if (adminSectionContainer && !isAdminSection) {
                 adminSectionContainer.style.display = "none";
             }
              // Ocultar subsecciones admin específicas
             if(adminProductsSection) adminProductsSection.style.display = "none";
             if(adminPersonalizeSection) adminPersonalizeSection.style.display = "none";


             let productsOK = true;
             if (needsPublicProducts && !productsLoaded) {
                 console.log(`Cargando productos públicos para ${sectionId}...`);
                 productsOK = await loadAndStorePublicProducts();
             }

             // Cargar settings si se va a Personalizar y no están cargados
             if (sectionId === 'admin-personalize' && (!currentSettings || Object.keys(currentSettings).length === 0)) {
                 console.log("Cargando settings para admin-personalize...");
                 await loadSiteSettings();
             }
              // Cargar productos admin si se va a esa sección
             if (sectionId === 'admin-products') {
                  console.log("Cargando productos para admin-products...");
                  await loadAdminProducts(); // Carga y renderiza la tabla
             }


             let sectionToShow;

             if (isAdminSection) {
                  if (adminSectionContainer) adminSectionContainer.style.display = "block"; // Mostrar contenedor padre admin
                  sectionToShow = document.getElementById(`${sectionId}-section`);
                  if (sectionToShow) {
                      sectionToShow.style.display = "block"; // Mostrar subsección admin
                      console.log(`Mostrando sección ADMIN: ${sectionId}`);
                      if (sectionId === 'admin-products') {
                          showAdminProductList(); // Asegurar que se muestra la lista y no el form
                      } else if (sectionId === 'admin-personalize') {
                          populatePersonalizeForm(); // Llenar form con settings actuales
                      }
                  } else {
                      console.warn(`Admin section ${sectionId} not found.`);
                      showPageSection('home'); // Ir a home si falla
                  }
             } else if (publicSections.includes(sectionId)) {
                  sectionToShow = document.getElementById(`${sectionId}-section`);
                  if (sectionToShow) {
                      sectionToShow.style.display = "block"; // Mostrar sección pública
                      console.log(`Mostrando sección pública: ${sectionId}`);

                      if (productsOK || !needsPublicProducts) { // Renderizar contenido si los productos cargaron bien (o no se necesitaban)
                          switch (sectionId) {
                              case "home":
                                  renderFeaturedProducts(featuredProductsContainer);
                                  createCarouselSlides();
                                  renderCategories();
                                  applyTextSettings(currentSettings); // Aplicar textos cargados
                                  break;
                              case "products":
                                  if (detailId) {
                                      renderProductDetail(productsDisplayArea, detailId);
                                  } else {
                                       // Asegurar que productsDisplayArea tenga clases de grid
                                       productsDisplayArea.className = "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8";
                                      renderProductGrid(productsDisplayArea);
                                  }
                                  break;
                              case "cart":
                                  renderCartPage();
                                  break;
                               case "contact": /* No necesita renderizado especial inicial */ break;
                               case "policies": /* No necesita renderizado especial inicial */ break;
                          }
                      } else { // Error al cargar productos necesarios
                          console.error(`Error loading products for public section ${sectionId}.`);
                           const errMsg = '<p class="col-span-full text-red-600 p-4 text-center">Error al cargar datos necesarios.</p>';
                          if (sectionId === 'products' && productsDisplayArea) productsDisplayArea.innerHTML = errMsg;
                          if (sectionId === 'home' && featuredProductsContainer) featuredProductsContainer.innerHTML = errMsg;
                          if (sectionId === 'cart' && cartItemsContainer) cartItemsContainer.innerHTML = errMsg;
                      }

                  } else {
                       console.warn(`Public section ${sectionId} not found.`);
                       showPageSection('home'); // Ir a home si falla
                  }
             } else {
                  console.warn(`Unknown section ${sectionId}.`);
                  showPageSection('home'); // Default a home
             }


             // Cerrar menú móvil si está abierto
             if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                 mobileMenu.classList.add("hidden");
                 if (mobileMenuButton) {
                     mobileMenuButton.setAttribute("aria-expanded", "false");
                     const openIcon = mobileMenuButton.querySelector("svg.block");
                     const closeIcon = mobileMenuButton.querySelector("svg.hidden");
                     if (openIcon) openIcon.classList.remove("hidden"); // Muestra hamburguesa
                     if (closeIcon) closeIcon.classList.add("hidden"); // Oculta X
                 }
             }
             // Cerrar dropdown admin desktop si está abierto
              if (adminMenuDesktopDropdown && !adminMenuDesktopDropdown.classList.contains('hidden')) {
                 adminMenuDesktopDropdown.classList.add('hidden');
             }

             window.scrollTo(0, 0); // Scroll al top
         }

        // updateUI (igual al archivo 1)
        function updateUI(isLoggedIn) {
            console.log("Updating UI, LoggedIn:", isLoggedIn);
            const userRole = localStorage.getItem('userRole');
            const isAdmin = isLoggedIn && userRole === 'admin';

            if (isLoggedIn) {
                if (loginSection) loginSection.style.display = "none";
                if (registerSection) registerSection.style.display = "none";
                if (mainContent) mainContent.style.display = "block"; // Mostrar contenido principal
            } else {
                if (loginSection) loginSection.style.display = "block"; // Mostrar login
                if (registerSection) registerSection.style.display = "none";
                if (mainContent) mainContent.style.display = "none"; // Ocultar contenido principal
                console.log("UI: Clearing cart on logout.");
                localStorage.removeItem(CART_STORAGE_KEY); // Limpiar carrito al salir
                updateCartIcon(); // Actualizar icono carrito
            }

            // Mostrar/ocultar opciones de Admin
            if (adminMenuDesktopContainer) adminMenuDesktopContainer.style.display = isAdmin ? 'block' : 'none';
            if (adminMenuMobileContainer) adminMenuMobileContainer.style.display = isAdmin ? 'block' : 'none';

            console.log("UI Updated.");
        }

        // --- Función de Checkout Wompi (igual al archivo 1) ---
        async function handleCheckout() {
            console.log(">>> [Checkout Wompi COP] Iniciando...");

            if (!configLoaded) { showMessage(cartCheckoutMessage, 'Error: Configuración de pago no cargada.', true); console.error("Checkout Wompi Error: Configuración no cargada."); return; }
            if (!wompiPublicKey || !frontendBaseUrl) { showMessage(cartCheckoutMessage, 'Error: Falta configuración de pago.', true); console.error("Checkout Wompi Error: Falta wompiPublicKey o frontendBaseUrl."); return; }

            const cart = getCart();
            if (cart.length === 0) { showMessage(cartMessageDiv, 'Carrito vacío.', true); return; }

            const { total } = calculateCartTotals();
            console.log(`[Checkout Wompi COP] Total calculado (debe ser COP): ${total}`);

            const reference = `ferremax_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
            const currency = 'COP'; // Moneda Colombiana
            const totalInCents = Math.round(total * 100); // Centavos de Peso
            const redirectUrl = `${frontendBaseUrl}/payment-status.html`; // URL de redirección post-pago

            showMessage(cartCheckoutMessage, 'Preparando checkout seguro con Wompi...', false);
            if (checkoutButton) {
                checkoutButton.disabled = true;
                // Añadir spinner del archivo 2
                checkoutButton.innerHTML = '<span class="loading-spinner mr-2"></span>Redirigiendo...';
            }

            try {
                // 1. Guardar orden temporal en backend
                const cartDataForBackend = cart.map(item => ({ productId: item.productId, quantity: item.quantity, price: item.price }));
                console.log(">>> [Checkout Wompi COP] Enviando datos temporales a POST /api/wompi/temp-order");
                const tempResponse = await fetch(`${API_URL}/api/wompi/temp-order`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ reference: reference, items: cartDataForBackend, total: total })
                });
                const tempData = await tempResponse.json();
                if (!tempResponse.ok || !tempData.success) { throw new Error(tempData.message || 'Error guardando orden temporal en backend.'); }
                console.log(">>> [Checkout Wompi COP] Orden temporal guardada en backend para referencia:", reference);

                // 2. Crear e abrir el widget de Wompi
                const checkout = new WidgetCheckout({
                    currency: currency,
                    amountInCents: totalInCents,
                    reference: reference,
                    publicKey: wompiPublicKey,
                    redirectUrl: redirectUrl
                    // Puedes añadir más opciones aquí si son necesarias: customerData, etc.
                });

                checkout.open(function (result) {
                    console.log(">>> [Checkout Wompi COP] Widget cerrado o redirigido. Resultado:", result);
                     // Restaurar botón independientemente del resultado (Wompi redirige en éxito)
                    if (checkoutButton) {
                         checkoutButton.disabled = false;
                         checkoutButton.innerHTML = '<i class="fas fa-credit-card mr-2"></i>Proceder al Pago';
                         hideMessages(cartCheckoutMessage);
                     }
                     // Aquí podrías manejar el 'result' si no hubo redirección (ej. error en Wompi)
                     if (result.error) {
                         showMessage(cartCheckoutMessage, `Error en Wompi: ${result.error.type || result.error.reason || 'Desconocido'}. Intenta de nuevo.`, true);
                     }
                });

            } catch (error) {
                console.error(">>> [Checkout Wompi COP] Error:", error);
                 showMessage(cartCheckoutMessage, `Error: ${error.message}. Intenta de nuevo.`, true);
                if (checkoutButton) { // Restaurar botón en error
                    checkoutButton.disabled = false;
                     checkoutButton.innerHTML = '<i class="fas fa-credit-card mr-2"></i>Proceder al Pago';
                }
            }
        }


        // --- Función para cargar configuración del backend (igual al archivo 1) ---
        async function loadFrontendConfig() {
            // Evitar recargar si ya está cargada
            if (configLoaded) return;
            console.log(">>> Cargando configuración del frontend desde el backend...");
            try {
                const response = await fetch(`${API_URL}/api/config`); // Llama a la ruta del backend
                if (!response.ok) { throw new Error(`Error ${response.status} al cargar configuración.`); }
                const configData = await response.json();

                if (configData.success && configData.wompiPublicKey && configData.frontendBaseUrl) {
                    wompiPublicKey = configData.wompiPublicKey;
                    frontendBaseUrl = configData.frontendBaseUrl;
                    configLoaded = true;
                    console.log(">>> Configuración cargada:", { wompiPublicKey: `pub...${wompiPublicKey.slice(-6)}`, frontendBaseUrl });
                } else {
                    throw new Error(configData.message || "Respuesta de configuración inválida.");
                }
            } catch (error) {
                console.error("!!! ERROR CRÍTICO AL CARGAR CONFIGURACIÓN FRONTEND:", error);
                 // Mostrar error crítico al usuario
                 if(pageContent) {
                     const configErrorDiv = document.createElement('div');
                      // Usa clases de mensaje de error archivo 2
                     configErrorDiv.className = 'message message-error p-4 text-center font-bold m-4';
                     configErrorDiv.textContent = 'Error crítico: No se pudo cargar la configuración de pago desde el servidor. El pago no funcionará.';
                     configErrorDiv.style.display = 'block';
                     pageContent.prepend(configErrorDiv); // Añadir al principio del contenido
                 }
                configLoaded = false; // Marcar como no cargada
                 // Podrías deshabilitar el botón de checkout aquí
                 if(checkoutButton) checkoutButton.disabled = true;
            }
        }

        // --- Funciones Admin (iguales al archivo 1) ---

        function renderAdminProductTable(products) {
            if (!adminProductsTableContainer) return;
            if (!products || products.length === 0) {
                adminProductsTableContainer.innerHTML = '<p class="p-4 text-gray-500 text-center">No hay productos registrados.</p>';
                return;
            }
            let tableHTML = `<table class="admin-table w-full text-sm"> <!-- Clases tabla admin -->
                <thead>
                    <tr class="bg-gray-100">
                        <th class="p-3">ID</th>
                        <th class="p-3">Img</th>
                        <th class="p-3">Nombre</th>
                        <th class="p-3">Precio</th>
                        <th class="p-3">Cant</th>
                        <th class="p-3">Acciones</th>
                    </tr>
                </thead>
                <tbody>`;
            products.forEach(p => {
                 const price = typeof p.precio_unitario === 'number' ? `$${p.precio_unitario.toFixed(2)}` : 'N/A';
                 const quantity = typeof p.cantidad === 'number' ? p.cantidad : 'N/A';
                 const imageUrl = p.imagen_url || `https://placehold.co/50x50/e2e8f0/475569?text=NI`;
                 const imageError = `this.onerror=null;this.src='https://placehold.co/50x49/fecaca/b91c1c?text=E';`;
                 tableHTML += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3">${p.ID_Producto}</td>
                        <td class="p-3"><img src="${imageUrl}" alt="${p.Nombre || ''}" class="product-thumbnail h-12 w-12 object-contain" onerror="${imageError}"></td>
                        <td class="p-3 whitespace-nowrap">${p.Nombre || '-'}</td>
                        <td class="p-3">${price}</td>
                        <td class="p-3">${quantity}</td>
                        <td class="p-3 whitespace-nowrap">
                            <button class="admin-action-button edit-button bg-blue-500 hover:bg-blue-600 text-white py-1 px-2 rounded text-xs" data-product-id="${p.ID_Producto}" title="Editar">
                                <i class="fas fa-edit pointer-events-none"></i>
                            </button>
                            <button class="admin-action-button delete-button bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-xs" data-product-id="${p.ID_Producto}" title="Eliminar">
                                <i class="fas fa-trash-alt pointer-events-none"></i>
                            </button>
                        </td>
                    </tr>`;
             });
            tableHTML += '</tbody></table>';
            adminProductsTableContainer.innerHTML = tableHTML;

             // Re-attach event listeners
            adminProductsTableContainer.querySelectorAll('.edit-button').forEach(button => button.addEventListener('click', (e) => handleEditProduct(e.currentTarget.dataset.productId)));
            adminProductsTableContainer.querySelectorAll('.delete-button').forEach(button => button.addEventListener('click', (e) => handleDeleteProduct(e.currentTarget.dataset.productId)));
            console.log("Admin product table rendered.");
        }


        function showAdminProductForm(product = null) {
            if (!adminProductFormContainer || !adminProductListContainer) { console.error("Admin form/list containers missing."); return; }
            adminProductListContainer.style.display = 'none'; // Ocultar lista
            adminProductFormContainer.style.display = 'block'; // Mostrar form
            hideMessages(adminProductFormMessageDiv); // Ocultar mensajes previos del form
            loadCategoriesIntoSelect(); // Cargar/asegurar categorías en el select

            if (product) { // Editar producto existente
                adminFormTitle.textContent = 'Editar Producto';
                adminSaveButton.textContent = 'Actualizar';
                adminProductIdInput.value = product.ID_Producto;
                // Llenar campos (usando IDs de los inputs)
                document.getElementById('admin-product-name').value = product.Nombre || "";
                document.getElementById('admin-product-brand').value = product.Marca || "";
                document.getElementById('admin-product-price').value = product.precio_unitario ?? "";
                document.getElementById('admin-product-quantity').value = product.cantidad ?? "";
                document.getElementById('admin-product-description').value = product.Descripcion || "";
                document.getElementById('admin-product-category').value = product.ID_Categoria || "";
                document.getElementById('admin-product-barcode').value = product.Codigo_Barras || "";
                document.getElementById('admin-product-image-url').value = product.imagen_url || "";
                console.log("Admin form populated for edit ID:", product.ID_Producto);
            } else { // Añadir nuevo producto
                adminFormTitle.textContent = 'Añadir Nuevo Producto';
                adminSaveButton.textContent = 'Guardar';
                if (adminProductForm) adminProductForm.reset(); // Limpiar form
                adminProductIdInput.value = ""; // Asegurar ID vacío
                console.log("Admin form cleared for add.");
            }
        }


        async function handleEditProduct(productId) {
            console.log(`Requesting data for edit ID: ${productId}`);
            hideMessages(adminProductsMessageDiv); // Ocultar mensajes de la lista
            try {
                const headers = { 'x-admin-simulated': 'true' };
                const response = await fetch(`${API_URL}/api/admin/products/${productId}`, { headers });
                if (!response.ok) { const errData = await response.json().catch(() => ({})); throw new Error(errData.message || `Error ${response.status}`); }
                const product = await response.json();
                if (!product) throw new Error("Product data not found in response.");
                 // Asegurar tipos antes de poblar el form
                 product.precio_unitario = parseFloat(product.precio_unitario) || null; // O 0 si prefieres
                 product.cantidad = parseInt(product.cantidad) || null; // O 0
                showAdminProductForm(product); // Mostrar form con datos
            } catch (error) {
                console.error("Error loading data for edit:", error);
                 showMessage(adminProductsMessageDiv, `Error cargando datos para editar: ${error.message}`, true); // Mostrar error en la lista
            }
        }


        function showAdminProductList() {
            if (adminProductFormContainer && adminProductListContainer) {
                adminProductFormContainer.style.display = 'none'; // Ocultar form
                adminProductListContainer.style.display = 'block'; // Mostrar lista
                hideMessages(adminProductFormMessageDiv); // Ocultar mensajes del form
            }
        }

        async function handleDeleteProduct(productId) {
            if (!confirm(`¿Estás seguro de eliminar el producto con ID ${productId}? Esta acción no se puede deshacer.`)) { return; }
            hideMessages(adminProductsMessageDiv);
            console.log(`Attempting delete ID: ${productId}`);
            try {
                const headers = { 'x-admin-simulated': 'true' };
                const response = await fetch(`${API_URL}/api/admin/products/${productId}`, { method: 'DELETE', headers });
                const result = await response.json().catch(() => ({ message: "Respuesta no JSON" }));
                console.log(`DELETE Response (${response.status}):`, result);
                if (response.ok && result.success) {
                     showMessage(adminProductsMessageDiv, '¡Producto eliminado exitosamente!', false);
                    await loadAdminProducts(); // Recargar la lista de productos
                    productsLoaded = false; // Marcar productos públicos como no actualizados
                } else {
                    throw new Error(result.message || `Error ${response.status}`);
                }
            } catch (error) {
                console.error(`Error deleting ${productId}:`, error);
                 showMessage(adminProductsMessageDiv, `Error al eliminar: ${error.message}`, true);
            }
        }


        // --- Funciones de Personalización (iguales al archivo 1) ---

        function applySiteSettings() {
             console.log("Applying site settings...");
             applyColorSettings(currentSettings);
             applyTextSettings(currentSettings);
              // Si la sección de personalización está visible, refrescar el formulario
             if (adminPersonalizeSection && adminPersonalizeSection.style.display === 'block') {
                 populatePersonalizeForm();
             }
         }

        function applyColorSettings(settings) {
            const root = document.documentElement;
             // Usa los colores del archivo 2 como fallback si no hay settings
            const primary = settings?.colorPrimary || '#2563eb';
            const secondary = settings?.colorSecondary || '#059669';
            const accent = settings?.colorAccent || '#f8fafc';

            root.style.setProperty('--color-primary', primary);
            root.style.setProperty('--color-primary-hover', darkenColor(primary, 15)); // Ajusta el % de oscurecimiento si es necesario
            root.style.setProperty('--color-secondary', secondary);
            root.style.setProperty('--color-secondary-hover', darkenColor(secondary, 10));
            root.style.setProperty('--color-accent', accent);
            root.style.setProperty('--color-price', secondary); // Precio usa color secundario por defecto
             // Podrías añadir más variables si el CSS las usa (dark, light, success, etc.)
            console.log("Color settings applied.");
        }

        function applyTextSettings(settings) {
             // Textos del archivo 2 como fallback
             if (mainWelcomeTitle) mainWelcomeTitle.textContent = settings?.welcomeTitle || 'Bienvenido a Ferremax';
             if (mainPromoTitle) mainPromoTitle.textContent = settings?.promoBannerTitle || '¡Ofertas Especiales de Temporada!';
             if (mainPromoText) mainPromoText.textContent = settings?.promoBannerText || 'Descubre increíbles descuentos en herramientas profesionales y materiales de construcción. Aprovecha estas ofertas por tiempo limitado.';
             console.log("Text settings applied.");
         }

        function populatePersonalizeForm() {
             if (!currentSettings) return;
             console.log("Populating personalize form with:", currentSettings);
             // Usar fallbacks del archivo 2 si no hay valor en currentSettings
             if (colorPrimaryInput) colorPrimaryInput.value = currentSettings.colorPrimary || '#2563eb';
             if (colorSecondaryInput) colorSecondaryInput.value = currentSettings.colorSecondary || '#059669';
             if (colorAccentInput) colorAccentInput.value = currentSettings.colorAccent || '#f8fafc';
             if (welcomeTitleInput) welcomeTitleInput.value = currentSettings.welcomeTitle || '';
             if (promoBannerTitleInput) promoBannerTitleInput.value = currentSettings.promoBannerTitle || '';
             if (promoBannerTextInput) promoBannerTextInput.value = currentSettings.promoBannerText || '';
             console.log("Personalize form populated.");
         }


        async function saveSiteSettings(settingsToSave) {
            hideMessages(adminPersonalizeMessageDiv);
            const isColors = 'colorPrimary' in settingsToSave;
            const buttonId = isColors ? 'save-colors-button' : 'save-texts-button';
            const button = document.getElementById(buttonId);
             const originalButtonText = button ? button.textContent : ''; // Guardar texto original
            if (button) {
                button.disabled = true;
                 button.innerHTML = '<span class="loading-spinner-dark mr-2"></span>Guardando...'; // Usar spinner oscuro
            }
            console.log("Saving settings:", settingsToSave);
            try {
                const headers = { 'Content-Type': 'application/json', 'x-admin-simulated': 'true' };
                const response = await fetch(`${API_URL}/api/admin/settings`, {
                    method: 'PUT', headers, body: JSON.stringify(settingsToSave)
                });
                const data = await response.json().catch(() => ({ message: "Respuesta no JSON" }));
                console.log(`Save Settings Response (${response.status}):`, data);
                if (response.ok && data.success) {
                    console.log("Settings saved:", data.settings);
                    currentSettings = { ...currentSettings, ...data.settings }; // Actualizar settings locales
                    applySiteSettings(); // Re-aplicar todos los settings
                     showMessage(adminPersonalizeMessageDiv, '¡Configuración guardada exitosamente!', false);
                } else {
                    throw new Error(data.message || `Error ${response.status}`);
                }
            } catch (error) {
                console.error("Error saving settings:", error);
                 showMessage(adminPersonalizeMessageDiv, `Error al guardar: ${error.message}`, true);
            } finally {
                if (button) {
                    button.disabled = false;
                     button.innerHTML = originalButtonText; // Restaurar texto original
                }
            }
        }


        // --- Manejadores de Eventos (iguales al archivo 1, adaptados a selectores archivo 2 si es necesario) ---
        function handleLogout() {
            localStorage.removeItem("userLoggedIn");
            localStorage.removeItem("userEmail");
            localStorage.removeItem("userRole");
            updateUI(false); // Actualiza UI para estado logged-out
            console.log("User logged out.");
            showPageSection('login'); // Muestra sección login
        }

        // Handler para click en categorías (igual al archivo 1)
        function handleCategoryClick(event) {
             const card = event.target.closest('.category-card'); // Busca el ancestro con la clase
             if (card) {
                 const categoryId = card.getAttribute('data-category-id');
                 console.log("Category click:", categoryId);
                 // Aquí podrías implementar el filtrado de productos si lo deseas
                 // Por ahora, simplemente va a la sección de productos generales
                 showPageSection('products');
             }
         }

         // Handler para clicks en grid/detalle (igual al archivo 1)
         function handleGridOrDetailClick(event) {
             const detailLink = event.target.closest(".product-detail-link"); // Click en imagen o título
             const addButton = event.target.closest(".add-to-cart-button"); // Click en botón añadir

             if (detailLink) {
                 const productId = detailLink.dataset.productIdDetail;
                 if (productId) {
                     showPageSection("products", productId); // Mostrar detalle
                 }
             } else if (addButton) {
                 // Prevenir que el click en el botón también dispare el link de detalle si están anidados
                 event.stopPropagation();
                 const productId = addButton.dataset.productIdAdd;
                 if (productId && !addButton.disabled) {
                     addToCart(productId, 1, addButton); // Añadir al carrito
                 }
             }
         }


        // --- Lógica de Inicialización (igual al archivo 1) ---
        document.addEventListener("DOMContentLoaded", async () => {
            console.log(">>> DOM Cargado. Iniciando App V19 (Conectado a Render)...");

            try {
                // --- 0. Cargar configuración del frontend ANTES que nada ---
                await loadFrontendConfig(); // Esperar a que cargue la config (Wompi Key, Base URL)

                // --- Limpieza inicial de carrito inválido ---
                try {
                    const cartData = localStorage.getItem(CART_STORAGE_KEY);
                    if (cartData) {
                        const parsed = JSON.parse(cartData);
                        if (!Array.isArray(parsed)) {
                            localStorage.removeItem(CART_STORAGE_KEY);
                        } else {
                            const validCart = parsed.filter(item => item && typeof item.productId !== 'undefined' && item.productId !== null);
                            if (validCart.length !== parsed.length) {
                                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(validCart));
                            }
                        }
                    }
                } catch (e) {
                    console.warn("Error limpiando carrito inicial, eliminando:", e);
                    localStorage.removeItem(CART_STORAGE_KEY);
                }

                // --- Actualizar año en footer ---
                const currentYearSpan = document.getElementById("current-year");
                if (currentYearSpan) currentYearSpan.textContent = new Date().getFullYear();

                // --- Verificar estado de login ---
                const isLoggedIn = localStorage.getItem("userLoggedIn") === "true";
                console.log(">>> Estado Login Inicial:", isLoggedIn);

                // --- 1. Cargar Settings del Sitio (Colores, Textos) ---
                console.log(">>> 1. Cargando Settings...");
                await loadSiteSettings(); // Carga y aplica settings

                // --- 2. Actualizar UI Base ---
                 // Ya no es necesario llamar a updateUI aquí explícitamente
                 // porque se llamará dentro de showPageSection o al final
                // console.log(">>> 2. Actualizando UI Base...");
                // updateUI(isLoggedIn); // Aplicar estado inicial LoggedIn/Out

                // --- 3. Actualizar Icono Carrito ---
                console.log(">>> 3. Actualizando Icono Carrito...");
                updateCartIcon();

                // --- 4. Añadir Listeners Principales ---
                console.log(">>> 4. Añadiendo Listeners...");

                // Login Form
                if (loginForm) loginForm.addEventListener("submit", async (event) => {
                    event.preventDefault(); hideMessages(loginMessageDiv);
                    const email = document.getElementById("login-email").value;
                    const password = document.getElementById("login-password").value;
                    const button = loginForm.querySelector('button[type="submit"]');
                    if (!button) return;
                    button.disabled = true; button.innerHTML = '<span class="loading-spinner-dark mr-2"></span>Ingresando...'; // Spinner
                    try {
                        const response = await fetch(`${API_URL}/login`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ email, password }) });
                        const result = await response.json();
                        if (response.ok && result.success) {
                            localStorage.setItem("userLoggedIn", "true");
                            localStorage.setItem("userEmail", email);
                            localStorage.setItem("userRole", result.user?.role || 'cliente');
                            productsLoaded = false; // Forzar recarga de productos/settings si es necesario al cambiar de usuario
                            await loadSiteSettings(); // Recargar settings por si cambian por rol
                            updateUI(true); // Actualizar UI a estado logueado
                            await showPageSection("home"); // Mostrar Home
                        } else {
                            showMessage(loginMessageDiv, result.message || "Error en el login.", true);
                        }
                    } catch (error) {
                        console.error("Error login fetch:", error);
                        showMessage(loginMessageDiv, "No se pudo conectar con el servidor.", true);
                    } finally {
                        if (button) { button.disabled = false; button.innerHTML = 'Iniciar Sesión'; } // Restaurar botón
                    }
                });

                 // Register Form
                 if (registerForm) registerForm.addEventListener("submit", async (event) => {
                     event.preventDefault(); hideMessages(registerMessageDiv);
                     const username = document.getElementById("register-username").value;
                     const email = document.getElementById("register-email").value;
                     const password = document.getElementById("register-password").value;
                     const terms = document.getElementById("terms")?.checked; // Verificar términos
                     const button = registerForm.querySelector('button[type="submit"]');
                     if (!button) return;

                     if (password.length < 6) { showMessage(registerMessageDiv, "La contraseña debe tener al menos 6 caracteres.", true); return; }
                      if (!terms) { showMessage(registerMessageDiv, "Debes aceptar los términos y condiciones.", true); return; }

                     button.disabled = true; button.innerHTML = '<span class="loading-spinner-dark mr-2"></span>Registrando...';
                     try {
                         const response = await fetch(`${API_URL}/register`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ username, email, password }) });
                         const result = await response.json();
                         if (response.ok && result.success) {
                              showMessage(registerMessageDiv, "¡Registro exitoso! Ahora puedes iniciar sesión.", false);
                              setTimeout(() => {
                                  if (registerSection) registerSection.style.display = "none";
                                  if (loginSection) loginSection.style.display = "block";
                                  if (loginForm) loginForm.reset(); // Limpiar form login por si acaso
                                  if (registerForm) registerForm.reset(); // Limpiar form registro
                                  hideMessages();
                              }, 2500); // Mostrar mensaje y luego cambiar a login
                         } else {
                              showMessage(registerMessageDiv, result.message || "Error en el registro.", true);
                         }
                     } catch (error) {
                         console.error("Error registro fetch:", error);
                          showMessage(registerMessageDiv, "No se pudo conectar con el servidor.", true);
                     } finally {
                         if (button) { button.disabled = false; button.innerHTML = 'Registrarse'; }
                     }
                 });


                // Contact Form
                if (contactForm) contactForm.addEventListener("submit", async (event) => {
                    event.preventDefault(); hideMessages(contactMessageResponseDiv);
                    if (!contactSubmitButton) return;
                    contactSubmitButton.disabled = true; contactSubmitButton.innerHTML = '<span class="loading-spinner-dark mr-2"></span>Enviando...';
                    const formData = new FormData(contactForm);
                    const contactData = Object.fromEntries(formData.entries());
                    // Validación simple frontend
                    if (!contactData.name || !contactData.email || !contactData.subject || !contactData.message) {
                         showMessage(contactMessageResponseDiv, "Por favor, completa todos los campos.", true);
                         contactSubmitButton.disabled = false; contactSubmitButton.textContent = "Enviar Mensaje";
                         return;
                    }
                    try {
                        const response = await fetch(`${API_URL}/api/contact`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(contactData) });
                        const result = await response.json();
                        if (response.ok && result.success) {
                             showMessage(contactMessageResponseDiv, "¡Mensaje recibido! Gracias por contactarnos.", false);
                             contactForm.reset();
                        } else {
                             showMessage(contactMessageResponseDiv, result.message || "Error al enviar el mensaje.", true);
                        }
                    } catch (error) {
                        console.error("Error contacto fetch:", error);
                         showMessage(contactMessageResponseDiv, "Error de conexión al enviar el mensaje.", true);
                    } finally {
                        if (contactSubmitButton) { contactSubmitButton.disabled = false; contactSubmitButton.textContent = "Enviar Mensaje"; }
                    }
                });

                 // Logout Buttons
                 if (logoutButton) logoutButton.addEventListener("click", handleLogout);
                 if (logoutButtonMobile) logoutButtonMobile.addEventListener("click", handleLogout);

                 // Links para mostrar Login/Register
                 if (showRegisterLink) showRegisterLink.addEventListener("click", (event) => {
                     event.preventDefault();
                     if (loginSection) loginSection.style.display = "none";
                     if (registerSection) registerSection.style.display = "block";
                     hideMessages();
                 });
                 if (showLoginLink) showLoginLink.addEventListener("click", (event) => {
                     event.preventDefault();
                     if (registerSection) registerSection.style.display = "none";
                     if (loginSection) loginSection.style.display = "block";
                     hideMessages();
                 });

                 // Navegación principal y admin
                 navLinks.forEach(link => link.addEventListener("click", (event) => {
                     const sectionId = link.getAttribute("data-section");
                     if (sectionId) {
                         event.preventDefault();
                         showPageSection(sectionId);
                     }
                 }));

                 // Botón CTA del banner promocional
                 const promoBtn = document.querySelector('.promo-banner .cta-button');
                 if (promoBtn) promoBtn.addEventListener('click', (e) => {
                     const sectionId = promoBtn.getAttribute('data-section'); // Debe ser 'products'
                     if (sectionId) {
                         e.preventDefault();
                         showPageSection(sectionId);
                     }
                 });

                 // Menú Móvil Toggle
                 if (mobileMenuButton && mobileMenu) {
                     mobileMenuButton.addEventListener("click", () => {
                         const isExpanded = mobileMenuButton.getAttribute("aria-expanded") === "true";
                         mobileMenuButton.setAttribute("aria-expanded", !isExpanded);
                         mobileMenu.classList.toggle("hidden");
                         const openIcon = mobileMenuButton.querySelector("svg.block"); // Icono hamburguesa
                         const closeIcon = mobileMenuButton.querySelector("svg.hidden"); // Icono X
                         // Alternar visibilidad de iconos
                         if (openIcon) openIcon.classList.toggle("hidden");
                         if (closeIcon) closeIcon.classList.toggle("hidden");
                     });
                 }

                // Admin Dropdown Desktop
                 if (adminMenuDesktopButton && adminMenuDesktopDropdown) {
                    adminMenuDesktopButton.addEventListener('click', (e) => {
                        e.stopPropagation(); // Evitar que el click cierre inmediatamente el dropdown
                        adminMenuDesktopDropdown.classList.toggle('hidden');
                    });
                     // Cerrar dropdown si se clickea fuera
                    document.addEventListener('click', (e) => {
                        if (adminMenuDesktopContainer && !adminMenuDesktopContainer.contains(e.target) && !adminMenuDesktopDropdown.classList.contains('hidden')) {
                            adminMenuDesktopDropdown.classList.add('hidden');
                        }
                    });
                }

                 // Click en Grid de Productos o Detalle
                 if (pageContent) pageContent.addEventListener('click', handleGridOrDetailClick);

                 // Cambios en Cantidad del Carrito
                 if (cartItemsContainer) {
                     cartItemsContainer.addEventListener('change', (e) => { // 'change' es mejor que 'input' para number
                         if (e.target.matches('.cart-item-input')) { // Clase del input de cantidad
                             updateCartQuantity(e.target.dataset.productIdQty, e.target.value);
                         }
                     });
                     // Click en botón eliminar del carrito (delegación)
                     cartItemsContainer.addEventListener('click', (e) => {
                         const removeButton = e.target.closest('.cart-item-remove-button'); // Clase del botón eliminar
                         if (removeButton) {
                             console.log("Remove button clicked for:", removeButton.dataset.productIdRemove);
                             removeFromCart(removeButton.dataset.productIdRemove);
                         }
                     });
                 }

                 // Click en Categorías (ya añadido en renderCategories)

                 // Botón Checkout
                 if (checkoutButton) checkoutButton.addEventListener('click', handleCheckout);

                 // Botones Admin: Añadir, Cancelar Edición
                 if (addProductButton) addProductButton.addEventListener('click', () => showAdminProductForm());
                 if (adminCancelButton) adminCancelButton.addEventListener('click', showAdminProductList);

                 // Submit Formulario Admin Productos
                 if (adminProductForm) adminProductForm.addEventListener('submit', async (event) => {
                     event.preventDefault();
                     hideMessages(adminProductFormMessageDiv);
                     if (!adminSaveButton || !adminProductIdInput) return;

                     adminSaveButton.disabled = true;
                     const productId = adminProductIdInput.value;
                      adminSaveButton.innerHTML = `<span class="loading-spinner-dark mr-2"></span>${productId ? 'Actualizando...' : 'Guardando...'}`;

                     const formData = new FormData(adminProductForm);
                     const productData = Object.fromEntries(formData.entries());
                     console.log("[Admin Form] Data to submit:", productData);

                     // Validación Frontend (mejorada)
                     let validationErrorMsg = null;
                     if (!productData.Nombre) validationErrorMsg = "El nombre es requerido.";
                     else if (productData.precio_unitario === '') validationErrorMsg = "El precio es requerido.";
                     else if (productData.cantidad === '') validationErrorMsg = "La cantidad es requerida.";
                     else if (!productData.Marca) validationErrorMsg = "La marca es requerida.";

                     if (validationErrorMsg) {
                          showMessage(adminProductFormMessageDiv, `${validationErrorMsg} (*)`, true);
                          adminSaveButton.disabled = false;
                          adminSaveButton.textContent = productId ? 'Actualizar' : 'Guardar';
                          return;
                     }

                     // Limpieza y conversión de tipos
                     try {
                         productData.precio_unitario = parseFloat(productData.precio_unitario);
                         productData.cantidad = parseInt(productData.cantidad, 10);
                         if (isNaN(productData.precio_unitario) || productData.precio_unitario < 0) throw new Error("Precio inválido");
                         if (isNaN(productData.cantidad) || productData.cantidad < 0) throw new Error("Cantidad inválida");

                         if (productData.ID_Categoria) {
                             productData.ID_Categoria = parseInt(productData.ID_Categoria, 10);
                             if (isNaN(productData.ID_Categoria)) delete productData.ID_Categoria;
                         } else { delete productData.ID_Categoria; }

                         if (!productData.Descripcion) delete productData.Descripcion;
                         if (!productData.Codigo_Barras) delete productData.Codigo_Barras;
                         if (!productData.imagen_url) delete productData.imagen_url;
                         delete productData.productId; // Eliminar el ID oculto del objeto a enviar

                     } catch (validationError) {
                          showMessage(adminProductFormMessageDiv, `Error en datos: ${validationError.message}`, true);
                          adminSaveButton.disabled = false;
                          adminSaveButton.textContent = productId ? 'Actualizar' : 'Guardar';
                          return;
                     }

                     // Envío al backend
                     const method = productId ? 'PUT' : 'POST';
                     const url = productId ? `${API_URL}/api/admin/products/${productId}` : `${API_URL}/api/admin/products`;
                     console.log(`[Admin Form] ${method} ${url}`, productData);

                     try {
                         const headers = { 'Content-Type': 'application/json', 'x-admin-simulated': 'true' };
                         const response = await fetch(url, { method, headers, body: JSON.stringify(productData) });
                         const result = await response.json().catch(() => ({ message: "Respuesta no JSON" }));
                         console.log(`[Admin Form] Response (${response.status}):`, result);
                         if (response.ok && result.success) {
                              showMessage(adminProductsMessageDiv, productId ? '¡Producto actualizado!' : '¡Producto añadido!', false); // Mostrar mensaje en la lista
                              showAdminProductList(); // Volver a la lista
                              await loadAdminProducts(); // Recargar lista admin
                              productsLoaded = false; // Marcar productos públicos como no actualizados
                         } else {
                             throw new Error(result.message || `Error ${response.status}`);
                         }
                     } catch (fetchError) {
                         console.error(`[Admin Form] Error ${method}:`, fetchError);
                          showMessage(adminProductFormMessageDiv, `Error al guardar: ${fetchError.message}`, true); // Mostrar error en el form
                     } finally {
                         if (adminSaveButton) {
                             adminSaveButton.disabled = false;
                             adminSaveButton.textContent = productId ? 'Actualizar' : 'Guardar'; // Restaurar texto
                         }
                     }
                 });

                 // Botones Guardar Personalización
                 if (saveColorsButton) saveColorsButton.addEventListener('click', () => {
                     const data = {
                         colorPrimary: colorPrimaryInput.value,
                         colorSecondary: colorSecondaryInput.value,
                         colorAccent: colorAccentInput.value
                     };
                     saveSiteSettings(data);
                 });

                 if (saveTextsButton) saveTextsButton.addEventListener('click', () => {
                     const data = {
                         welcomeTitle: welcomeTitleInput.value.trim(),
                         promoBannerTitle: promoBannerTitleInput.value.trim(),
                         promoBannerText: promoBannerTextInput.value.trim()
                     };
                     saveSiteSettings(data);
                 });

                // Listeners Carrusel
                if (carouselPrevButton) carouselPrevButton.addEventListener('click', () => { prevSlide(); stopSlideInterval(); }); // Detener auto-slide en manual
                if (carouselNextButton) carouselNextButton.addEventListener('click', () => { nextSlide(); stopSlideInterval(); });
                const carouselContainer = document.querySelector('.carousel-container');
                if (carouselContainer) {
                    carouselContainer.addEventListener('mouseenter', stopSlideInterval);
                    carouselContainer.addEventListener('mouseleave', startSlideInterval);
                }

                // --- 5. Mostrar Sección Inicial ---
                console.log(">>> 5. Mostrando Sección Inicial...");
                if (isLoggedIn) {
                    await showPageSection("home"); // Muestra Home si está logueado
                } else {
                    // Si no está logueado, la UI ya muestra la sección de login por defecto
                    console.log(">>> Mostrando sección de Login (usuario no logueado).");
                     // Asegurarse que solo login esté visible si no está logueado
                     if(loginSection) loginSection.style.display = 'block';
                     if(registerSection) registerSection.style.display = 'none';
                     if(mainContent) mainContent.style.display = 'none';
                }

                console.log(">>> INICIALIZACIÓN COMPLETA (V19 - Conectado a Render) <<<");

            } catch (error) {
                // --- Error Crítico Durante Inicialización ---
                console.error("!!! ERROR CRÍTICO DURANTE LA INICIALIZACIÓN !!!", error);
                 // Mostrar mensaje de error que reemplace todo el body
                 document.body.innerHTML = `
                    <div style="padding: 2rem; text-align: center; color: #b91c1c; background-color: #fee2e2; border: 2px solid #fecaca; margin: 2rem; font-family: sans-serif; border-radius: 8px;">
                        <h1 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">Error Crítico</h1>
                        <p>La aplicación no pudo iniciarse correctamente.</p>
                        <p>Por favor, revisa la consola del navegador (presiona F12) para más detalles.</p>
                        <p style="margin-top: 1rem; font-weight: bold;">Mensaje: ${error.message}</p>
                    </div>`;
            }
        });

        console.log("--- Script Ferremax V19 (Conectado a Render) Cargado ---");
    </script>
    <!-- ====================================================== -->
    <!--       FIN: JavaScript del Archivo 1 (Original)       -->
    <!-- ====================================================== -->

</body>
</html>